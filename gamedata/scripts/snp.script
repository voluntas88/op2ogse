-- -*- mode: lua; coding: windows-1251-dos -*-
-- snp основной скрипт

-- общий калбек на подъем предмета
function checking_taken_item_snp(obj)
	local se_obj
	local section = obj:section()
	if     section == "snp_pda1" then
		db.actor:give_info_portion("snp_borov1_start")

	elseif section == "snp_note1" then
		if not has_alife_info("snp_find_name1_have") then 
			se_obj = alife():create("kotobegemot_bar",vector():set(115.00399780273,-5.3044028282166,14.159286499023),33614,1239)
			set_stalker_story_id(se_obj,19901)
			db.actor:give_info_portion("snp_find_name1_have")
		end

	elseif section == "snp_pda2" then
		db.actor:give_info_portion("snpt_kordon1_have")

	elseif section == "snp_pda3" then
		if not has_alife_info("snp_almaz0") then 
			snp_spawn.suslov_marsh_sms2()
			db.actor:give_info_portion("snp_almaz0")
		end

	elseif section == "snp_pda4" then
		db.actor:give_info_portion("snpt_sd4_have")

	elseif section == "snp_pda5" then
		if not has_alife_info("snpt_pp1_have2") then
			-- Прайм заболел
			alife():release(object_by_section_offline("bibliofrend_talk_zaton"))
			se_obj = object_by_section_offline("bibliofrend_zaton")
			local params = amk.read_monster_params(se_obj)
			params.visual = "monsters\\bibliotekar\\bibliotekar_black"
			amk.write_monster_params(params,se_obj)
			local obj = alife():create("bibliofrend_talk_black_zaton",vector():set(124.68988037109,-7.3328924179077,177.81799316406),1180494,3686)
			set_stalker_story_id(obj,19927)
			db.actor:give_info_portion("snpt_pp1_have2")
		end
		
	elseif section == "snp_pda6" then
		if not has_alife_info("snp_semetskiy_pda_have") then 
			kostya_dialog.create_teleport("tele_limansk4",vector():set(-11.73425579071,-0.16019485890865,-141.75788879395),19162,2993)
			db.actor:give_game_news("%c[255,160,160,160]"..user_name().."\\n%c[default]Наконец-то нашёл труп Семецкого. Но что-то мне подсказывает, что это не конец, и он еще не раз порадует нас своей смертью.", "ui\\ui_iconsTotal", Frect():set(498,47,83,47), 5000, 20000)
			xr_sound.get_safe_sound_object("device\\pda\\pda_tip"):play(db.actor, 5, sound_object.s2d)
			db.actor:give_info_portion("snp_semetskiy_pda_have")
		end

	elseif section == "snp_pda7" then
		if not has_alife_info("snpt_2chaes2_done") then 
			local timeout = 5
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ПРОПЕР СЕМИДЕСЯТЫЙ:".."\\n".."%c[255,255,128,128]Стрелок, ты где пропал? Почему молчишь? Что с Сахаровым?".."\n", timeout, nil, 20000)
			timeout = timeout+8
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Пропер Семидесятый, иду к вам. Занесло меня на ЧАЭС-2. Есть результат!".."\n", timeout, nil, 20000)
			db.actor:give_info_portion("snpt_2chaes2_done")
		end

	elseif section == "snp_pda8" then
		if not has_alife_info("snpt_mg2_have2") then 
			local timeout = 5
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Бродяга, я выполнил заказ. У меня ПДА клиента. Отправляю тебе с него несколько файлов в качестве доказательства, что дело сделано.".."\n", timeout, nil, 20000)
			timeout = timeout+10
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."БРОДЯГА:".."\\n".."%c[255,255,128,128]Получил! Спасибо за помощь, Стрелок. Жду тебя на Скадовске.".."\n", timeout, nil, 20000)
			se_obj = alife():create("brodaga_zaton",vector():set(122.5481262207,-7.3221473693848,185.99839782715),1176929,3686)
			set_stalker_story_id(se_obj,19914)
			db.actor:give_info_portion("snpt_mg2_have2")
		end

	elseif section == "snp_pda9" then
		db.actor:give_info_portion("snpt_cp2_have")

	elseif section == "snp_pda10" then
		amk.remove_item_from_inventory_by_name("snp_pda10",db.actor)
		kostya_dialog.create_teleport("snp_uagro1_tp1",db.actor:position(),db.actor:level_vertex_id(),db.actor:game_vertex_id())
	
	elseif section == "snp_pda11" then
		amk.remove_item_from_inventory_by_name("snp_pda11",db.actor)
		db.actor:give_info_portion("emb17")

	elseif section == "snp_pda12" then
		amk.remove_item_from_inventory_by_name("snp_pda12",db.actor)
		db.actor:give_info_portion("embt_vp1_done")

	elseif section == "snp_pda13" then
		amk.remove_item_from_inventory_by_name("snp_pda13",db.actor)
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Э, нет, братец! Если бы это было так просто, я бы тебя не просил! Этот ПДА я специально оставил здесь, чтобы проверить, не попытаешься ли ты меня провести. Лёжка моя совсем в другом месте. Ищи её!".."\n", nil, nil, 30000)

	elseif section == "snp_pda14" then
		db.actor:give_info_portion("snpt_2chaes3_have")

	elseif string.find(section,"snp_biopart") then
		if section == "snp_biopart4" then
			amk.remove_item_from_inventory_by_name("snp_note30",db.actor)
			db.actor:give_info_portion("snpt_vp3_done")
			snp_spawn.n_inventory_box_vp6()
		end
		local i = string.sub(section,12,12)
		local p = "snp_bioradar_parts"..i
		if not has_alife_info(p) then
			if tonumber(i) < 5 then
				amk.remove_item_from_inventory(obj,db.actor)
				alife():create("snpbiopart",vector():set(0,0,0),0,0,0)
			end
			db.actor:give_info_portion(p)
		end

	elseif section == "snp_almaz_note2" then
		if not has_alife_info("snp_almaz_note2") then 
			amk.remove_item_from_inventory_by_name("snp_almaz_note1",db.actor)
			sak.set_mark_on_tajnik("n_inventory_box_almaz3",vector():set(48.840072631836,2.2752776145935,-27.195747375488),162369,2137)
			db.actor:give_info_portion("snp_almaz_note2")
		end

	elseif section == "af_idol_monolita" then
		if has_alife_info("snp_almaz3") and not has_alife_info("snp_almaz_done") then 
			xr_sound.get_safe_sound_object([[heart\5]]):stop()
		end

	elseif section == "snp_note10" then
		if not has_alife_info("snp_note10_have") then 
			sak.set_mark_on_tajnik("n_inventory_box_kl1_2",vector():set(-199.62145996094,10.08634185791,-256.50994873047),868,3234)
			db.actor:give_info_portion("snp_note10_have")
		end
		
	elseif section == "snp_note13" then
		if not has_alife_info("snp_note13_have") then 
			amk.remove_item_from_inventory_by_name("snp_note12",db.actor)
			sak.set_mark_on_tajnik("n_inventory_box_kl1",vector():set(-116.12890625,27.069087982178,17.880420684814),10076,3240)
			db.actor:give_info_portion("snp_note13_have")
		end

	elseif section == "snp_note20" then
		if not has_alife_info("snp_note20_have") then 
			sak.set_mark_on_tajnik("n_inventory_box_cp4_1",vector():set(47.505016326904,8.9497900009155,-104.69525146484),159188,2136)
			db.actor:give_info_portion("snp_note20_have")
		end

	elseif db.actor:object("snp_note24") and db.actor:object("snp_note23") then
		amk.remove_item_from_inventory_by_name("snp_note23",db.actor)
		amk.remove_item_from_inventory_by_name("snp_note24",db.actor)
		db.actor:give_info_portion("emb0")

	elseif section == "snp_plan" then
		db.actor:give_info_portion("snpt_sd1_have")
		
	elseif section == "snp_prime_maz_green" then
		db.actor:give_info_portion("snp_bibliofrend_black1_have1")

	elseif section == "wpn_m4_m1" then
		if has_alife_info("snp_bioradar_parts5") and not has_alife_info("snpt_2chaes1_done") then 
			db.actor:give_info_portion("snpt_2chaes1_done")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Здравствуй, Брат Стрелок! Раз ты получил это сообщение - значит, меня нет в живых. Сильно ранили меня тогда на Кордоне, неохота было подыхать на Скадовске медленной, мучительной смертью... Воин должен погибнуть в бою. От твоей пули умереть - честь для меня, ты - достойный Воин. В Лиманске есть тайник у меня, до него не просто добраться. Во дворе, где фонтан, за забором есть двухэтажное здание, в этом здании на втором этаже тайник. Он твой.\\nПрошу тебя: Анне ничего не говори. Или скажи, что я ушёл куда-нибудь. Да, и после того, как найдёшь мой тайник в Лиманске, загляни к Обители Зла, я оставил у него ещё кое-что для тебя.\\nПрощай, Брат Стрелок!...".."\n", 6, nil, 45000)
			amk.start_timer("run", 55, "snp.fenrir_gone()")
		end

	elseif section == "fake_wpn_topor" then
		if has_alife_info("krest_topor") then
			db.actor:give_info_portion("krest_topor_done")
		end

	elseif section == "ammo_gravi" then
		alife():release(alife():object(obj:id()))

	elseif section == "letter" then
		alife():release(alife():object(obj:id()))
		archievements.acv_count_event("acv_ptln", 30, "Почтальон") 

	elseif string.find(section,"fli_code") then
		if not has_alife_info("teleport_started") then
			se_obj = string.sub(section,9)
			if not has_alife_info("fli_have"..se_obj) then
				db.actor:give_info_portion("fli_have"..se_obj)
				fly_island.spawn_zanoza(tonumber(se_obj))
			end

			if not has_alife_info("fli_have_1") and db.actor:object("fli_code36") and db.actor:object("fli_code29") and db.actor:object("fli_code37") and db.actor:object("fli_code33") and db.actor:object("fli_code35") and db.actor:object("fli_code31") and db.actor:object("fli_code9") and db.actor:object("fli_code1") then
				db.actor:give_info_portion("fli_have_1")
			end
		end

	elseif section == "af_sunlight" then
		if has_alife_info("info_amk_recipt_fake") and not has_alife_info("teleport_started") and not has_alife_info("info_amk_recipt_fake_done") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОСВЕДОМИТЕЛЬ:".."\\n".."%c[255,255,128,128]Ты нашёл-таки артефакт \"Солнечный свет\"? Молодец. Ведь рецепта на него не существует - я тебя кинул на 500 штук, когда продал тебе его, помнишь? Но ничего, теперь тебе уже все равно. И не забывай, я всегда готов поделиться информацией за разумную плату!".."\n", nil, nil, 40000)
			db.actor:give_info_portion("info_amk_recipt_fake_done")
		end
		
	elseif section == "fli_pda1" then
		if not has_alife_info("fli_nolik_done") then 
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК (мысли вслух):".."\\n".."%c[255,255,128,128]Думаю, пока рано говорить Марии о находке. Это труп не Снегиря. Самого Снегиря я пока не нашёл. Нужно продолжить поиски. Только где? "..user_name()..", есть какие-нибудь идеи?".."\n", 10, "str", 30000)
			db.actor:give_info_portion("fli_nolik_done")
		end

	end
end

-- общий калбек на взятие тайника без уникальных предметов
function check_treasure(box)
	local se_obj
	local section = box:section()
	if string.find(section, "emb_inventory_box") then
		-- эмбрионы невидимые тайники
		emb.worker()

	elseif string.find(section, "shadow") then
		-- тени
		snp_shadow.worker()

	elseif string.find(section, "inventory_box_fli") then
		-- острова
		fly_island.final_worker(section)

	elseif section == "n_inventory_box_dt1" then
		db.actor:give_info_portion("snpt_dt1_have")

	elseif section == "n_inventory_box_dt2" then
		-- Прайм вылечился
		alife():release(object_by_section_offline("bibliofrend_talk_black_zaton"))
		se_obj = object_by_section_offline("bibliofrend_zaton")
		local params = amk.read_monster_params(se_obj)
		params.visual = "monsters\\bibliotekar\\bibliotekar"
		amk.write_monster_params(params,se_obj)
		local obj = alife():create("bibliofrend_talk_zaton",vector():set(124.68988037109,-7.3328924179077,177.81799316406),1180494,3686)
		set_stalker_story_id(obj,19926)
		db.actor:give_info_portion("snpt_dt2_have")

	elseif section == "n_inventory_box_dt3" then
		amk.remove_item_from_inventory_by_name("gena_note1",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_cp11",vector():set(-12.712896537781,-5.1684684944153,193.19522900391),90728,2195)

	elseif section == "n_inventory_box_agro1" then
		if has_alife_info("snpt_agro1_fail") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."КОМАНДА СОЗДАТЕЛЕЙ ОП-2:".."\\n".."%c[255,255,128,128]Зря ты, "..user_name()..", использовал гравипушку, чтобы добраться до этого тайника. Очень зря. Мы настоятельно рекомендуем тебе переиграть этот эпизод и все-таки постараться выбраться здесь за границу территории без использования гравипушки. У тебя уже достаточно опыта, чтобы сделать это. Выход настолько прост и настолько красив, что удовольствие от его нахождения ты запомнишь очень надолго!", 3, nil, 40000)
		else
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."КОМАНДА СОЗДАТЕЛЕЙ ОП-2:".."\\n".."%c[255,255,128,128]Красивый выход, правда, "..user_name().."?! Это тот редкий случай, когда радость от нахождения пути к тайнику больше, чем радость от содержимого тайника!", 3, nil, 30000)
		end
		db.actor:give_info_portion("snpt_agro1_have")

	elseif section == "n_inventory_box_kordon2" then
		sak.set_mark_on_tajnik("n_inventory_box_kordon2_2",vector():set(65.351554870605,8.6025924682617,39.333652496338),301349,423)

	elseif section == "n_inventory_box_kordon2_2" then
		amk.remove_item_from_inventory_by_name("fli_note15",db.actor)
	
	elseif section == "n_inventory_box_kordon5" then
		db.actor:give_info_portion("snpt_kordon2_done")

	elseif section == "n_inventory_box_vp1" then
		db.actor:give_info_portion("no_teleport_near_heli_btr")
		se_obj = object_by_section_offline("snp_pda13")
		if se_obj then
			alife():release(se_obj)
		end
		create_restrictor_out(db.actor:position(),db.actor:level_vertex_id(),db.actor:game_vertex_id(),30,"snp.heli_vp1_fail")
		snp_spawn.n_inventory_box_vp1()

	elseif section == "n_inventory_box_vp1_2" then
		sak.set_mark_on_tajnik("n_inventory_box_vp1_3",vector():set(13.420848846436,15.939820289612,376.03521728516),219643,3760)

	elseif section == "n_inventory_box_vp1_3" then
		amk.remove_item_from_inventory_by_name("snp_note3",db.actor)
		create_restrictor(vector():set(81.403007507324,12.320181846619,354.12557983398),302206,3760,1,"snp_spawn.n_inventory_box_vp1_4")

	elseif section == "n_inventory_box_vp1_4" then
		amk.remove_item_from_inventory_by_name("snp_note4",db.actor)
		db.actor:give_info_portion("snpt_vp2_done")
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Стрелок, если ещё интересуют подобные нестандартные тайники - зайди, поговорим.".."\n", 3, nil, 20000)

	elseif section == "n_inventory_box_vp7" then
		if not has_alife_info("snpt_kl1_found2") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ДОЦЕНТ:".."\\n".."%c[255,255,128,128]Стрелок, ты добрался до тайника каким-то другим путём, а не от причала, как я тебе говорил. Поэтому блокноты я у тебя приму, но выполнение задания не засчитано.".."\n", nil, nil, 30000)
			db.actor:give_info_portion("snpt_kl1_fail")
		end
		db.actor:give_info_portion("snpt_kl1_have2")
		move_ariadna_to_bar()
		
	elseif section == "n_inventory_box_limansk1" then
		sak.set_mark_on_tajnik("n_inventory_box_limansk1_2",vector():set(-54.28849029541,4.0246248245239,159.91932678223),9647,3010)

	elseif section == "n_inventory_box_limansk1_2" then
		amk.remove_item_from_inventory_by_name("snp_note5",db.actor)
		db.actor:give_info_portion("snpt_limansk1_have")

	elseif section == "n_inventory_box_limansk2" then
		sak.set_mark_on_tajnik("n_inventory_box_limansk2_1",vector():set(83.74320251465,22.1644155263901,91.979831542969),51783,3020)

	elseif section == "n_inventory_box_limansk2_1" then
		amk.remove_item_from_inventory_by_name("snp_note14",db.actor)
		create_restrictor(vector():set(78.972717285156,33.845104217529,185.52560424805),51783,3020,1,"snp_spawn.n_inventory_box_limansk2_1")

	elseif section == "n_inventory_box_limansk2_2" then
		db.actor:give_info_portion("snpt_limansk2_have")

	elseif section == "n_inventory_box_limansk3" then
		db.actor:give_info_portion("snpt_limansk3_done")
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Стрелок, ты куда пропал? Фенрир сказал, ты должен зайти.".."\n", 3, nil, 15000)

	elseif section == "n_inventory_box_limansk4" then
		db.actor:give_info_portion("snpt_limansk4_have")
		amk.remove_item_from_inventory_by_name("snp_pda6",db.actor)
		snp_spawn.n_inventory_box_limansk4()

	elseif section == "n_inventory_box_limansk10" then
		sak.set_mark_on_tajnik("n_inventory_box_limansk11",vector():set(8.605899810791,8.113245010376,81.677447509766),21950,2988)
		kostya_dialog.delete_teleport("snp_shadow_tp6")

	elseif section == "n_inventory_box_limansk11" then
		amk.remove_item_from_inventory_by_name("snp_note38",db.actor)
	
	elseif section == "n_inventory_box_limansk12" then
		amk.remove_item_from_inventory_by_name("snp_note46",db.actor)
	
	elseif section == "n_inventory_box_almaz1" then
		amk.remove_item_from_inventory_by_name("snp_pda3",db.actor)

	elseif section == "n_inventory_box_almaz14" then
		xr_sound.get_safe_sound_object([[snp\heartbeat100]]):stop()
		amk.remove_item_from_inventory_by_name("snp_almaz_note13",db.actor)
		db.actor:give_info_portion("snp_almaz1")
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ТЕНЬ МОНОЛИТА:".."\\n".."%c[255,255,128,128]Избранный, наконец ты собрал все Алмазные черепа! Найди же место активации и активируй их! Продолжай слушать своё сердце, Избранный! Оно приведёт тебя к истине, смертный!".."\n", 5, nil, 30000)
		kostya_dialog.create_teleport("tele_almaz_act",vector():set(166.77569580078,43.172966003418,386.25317382813),172634,2987)
		alife():create("zone_monolith_snp",vector():set(174.08480834961,55.11833190918,386.01168823242),172632,2987)
		start_sound()

	elseif section == "n_inventory_box_x101" then
		sak.set_mark_on_tajnik("n_inventory_box_x101_2",vector():set(-30.335075378418,-11.727508544922,48.893642425537),1960,2744)
		
	elseif section == "n_inventory_box_x101_2" then
		amk.remove_item_from_inventory_by_name("snp_note6",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_x101_3",vector():set(-17.047734069824,-9.5494222640991,-34.517933197021),3773,2665)

	elseif section == "n_inventory_box_x101_3" then
		db.actor:give_info_portion("snpt_x101_have")
		amk.remove_item_from_inventory_by_name("snp_note7",db.actor)
		xr_sound.get_safe_sound_object([[monsters\bloodsucker\bloodsucker_script_attack_0]]):play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		dsh.create_free_monster("deathclaw_strong",vector():set(-19.920612335205,-9.5487899780273,-41.595027923584),3546,2665)

	elseif section == "n_inventory_box_x81" then
		kostya_dialog.create_teleport("tele_kl1",vector():set(-126.73837280273,-7.9817929267883,-57.95435333252),8203,3240)

	elseif section == "n_inventory_box_x82" then
		db.actor:give_info_portion("snpt_x82_done")

	elseif section == "n_inventory_box_x83" then
		kostya_dialog.create_eh_lc(220101, vector():set(16.434181213379,-7.8957762718201,19.228824615479),6993,3211,
			vector():set(-36.416271209717,-34.481643676758,13.138676643372),413,2483,
			vector():set(0,0,0),
			"l12u_control_monolith",
			0)
		create_restrictor(vector():set(16.434181213379,-7.8957762718201,19.228824615479),6993,3211,3,"snp.gena_bum1")

	elseif section == "n_inventory_box_kl1" then
		db.actor:give_info_portion("snpt_x81_done")
		amk.remove_item_from_inventory_by_name("snp_note9",db.actor)
		amk.remove_item_from_inventory_by_name("snp_note13",db.actor)

	elseif section == "n_inventory_box_kl3" then
		if not has_alife_info("snpt_kl1_found1") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ДОЦЕНТ:".."\\n".."%c[255,255,128,128]В Красном Лесу существует единственный прямой выход за границу территории. Но ты, судя по всему, им не воспользовался, а пошёл каким-то другим, неизвестным мне путём. Поэтому блокноты я у тебя приму, но выполнение задания не засчитано.".."\n", nil, nil, 30000)
			db.actor:give_info_portion("snpt_kl1_fail")
		end
		db.actor:give_info_portion("snpt_kl1_have1")
		move_ariadna_to_bar()

	elseif section == "n_inventory_box_sd2" then
		db.actor:give_info_portion("snpt_sd2_have")

	elseif section == "n_inventory_box_cp1" then
		db.actor:give_info_portion("snpt_cp1_have")

	elseif section == "n_inventory_box_pp1" then
		db.actor:give_info_portion("snpt_pp1_have1")
		create_restrictor(vector():set(14.366353034973,26.801988601685,3.5365107059479),21893,3792,2,"snp_spawn.n_inventory_box_pp1")
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Братишка, лезь на кран-балку, оттуда лучше обзор будет.".."\n", 10, nil, 20000)
		
	elseif section == "n_inventory_box_td1" then
		if not has_alife_info("snpt_td1_have1") then
			db.actor:give_info_portion("snpt_td1_have1")
		else
			db.actor:give_info_portion("snpt_td1_have2")
		end

	elseif section == "n_inventory_box_garbage1" then
		snp_spawn.n_inventory_box_garbage1()
		
	elseif section == "n_inventory_box_garbage2" then
		snp_spawn.n_inventory_box_garbage2()

	elseif section == "n_inventory_box_garbage3_1" then
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ИСТОЧНИК НЕИЗВЕСТЕН:".."\\n".."%c[255,255,128,128]Между цистернами.".."\n", nil, nil, 10000)
		kostya_dialog.create_teleport("snp_receipt_parts2_tp2",vector():set(69.402984619141,7.087566614151,98.179962158203),239958,370)

	elseif section == "n_inventory_box_garbage3_2" then
		kostya_dialog.create_teleport("snp_receipt_parts2_tp4",vector():set(36.57763671875,9.8525171279907,235.24243164063),209829,359)
		sak.set_mark_on_tajnik("n_inventory_box_garbage3_3",vector():set(88.548858642578,14.494812965393,-150.32049560547),255908,412)

	elseif section == "n_inventory_box_garbage3_3" then
		db.actor:give_info_portion("snp_receipt_parts2_have")
		amk.remove_item_from_inventory_by_name("snp_note19",db.actor)

	elseif section == "n_inventory_box_cp2" then
		sak.set_mark_on_tajnik("n_inventory_box_cp3",vector():set(209.37040710449,2.7850260734558,87.78483581543),257446,2145)

	elseif section == "n_inventory_box_cp3" then
		db.actor:give_info_portion("snp_receipt_parts1_have")
		amk.remove_item_from_inventory_by_name("snp_note17",db.actor)

	elseif section == "n_inventory_box_cp11" then
		amk.remove_item_from_inventory_by_name("gena_note2",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_gen2",vector():set(58.491859436035,32.280834197998,-551.94244384766),404600,3117)

	elseif section == "n_inventory_box_cp4_1" then
		amk.remove_item_from_inventory_by_name("snp_note20",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_cp4_2",vector():set(47.559024810791,8.9481220245361,-164.22630310059),159135,2136)
		
	elseif section == "n_inventory_box_cp4_2" then
		amk.remove_item_from_inventory_by_name("snp_note21",db.actor)
		kostya_dialog.create_teleport("snp_cp_tp1",vector():set(146.888671875,11.983012199402,116.23860931396),243444,2174)

	elseif section == "n_inventory_box_cp4_3" then
		db.actor:give_info_portion("snp_receipt_parts4_have")
		amk.remove_item_from_inventory_by_name("snp_note22",db.actor)

	elseif section == "n_inventory_box_x161" then
		db.actor:give_info_portion("snp_receipt_parts3_have")
		snp_spawn.n_inventory_box_x161()
		se_obj = alife():create("lobsang_zaton",vector():set(132.97550964355,-7.3394374847412,189.05435180664),1194666,3686)
		set_stalker_story_id(se_obj,19906)

	elseif section == "n_inventory_box_jupiter1" then
		db.actor:give_info_portion("snp_receipt_parts5_have")

	elseif section == "n_inventory_box_jupiter8" then
		sak.set_mark_on_tajnik("n_inventory_box_jupiter8_2",vector():set(387.51806640625,15.237261772156,-85.501846313477),1328997,3744)

	elseif section == "n_inventory_box_jupiter8_2" then
		amk.remove_item_from_inventory_by_name("snp_note44",db.actor)
		snp_spawn.n_inventory_box_jupiter8_2()

	elseif section == "n_inventory_box_jupiter11" then
		amk.remove_item_from_inventory_by_name("snp_note26",db.actor)

	elseif section == "n_inventory_box_2chaes1" then
		create_item_and_restrictor("fenrir_2chaes",vector():set(941.21911621094,13.052788734436,273.22985839844),250079,2642)
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Фенрир, падла, кинуть меня решил?".."\n", 4, nil, 15000)
		
	elseif section == "n_inventory_box_2chaes2" then
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."КОМАНДА СОЗДАТЕЛЕЙ ОП-2:".."\\n".."%c[255,255,128,128]Да, "..user_name().."! Да, ты сделал это! Ты нашёл сюда путь! Ну что тут скажешь? Ты - настоящий S.T.A.L.K.E.R.!".."\n", 3, nil, 50000)
		kostya_dialog.delete_teleport("fli_block_tp1")
		kostya_dialog.delete_teleport("fli_block_tp2")

	elseif section == "n_inventory_box_as2" then
		se_obj = sak.set_mark_on_tajnik("n_inventory_box_dt3",vector():set(-61.349769592285,-0.71912717819214,470.66595458984),20316,1384)
		amk.add_spot_on_map(se_obj.id,"crlc_mdl","Место поиска следующей информации от Эльзы") 

	elseif section == "n_inventory_box_mg1" then
		sak.set_mark_on_tajnik("n_inventory_box_limansk12",vector():set(10.524602584839,1.8927528858185,-391.09912109375),30960,3006)

	elseif section == "n_inventory_box_mg2" then
		db.actor:give_info_portion("snpt_mg2_have1")
		create_restrictor(vector():set(-74.212478637695,2.7899203300476,64.743927001953),272032,3622,80,"snp_spawn.snpt_mg2_lastday")
	
	elseif section == "n_inventory_box_bar1" then
		db.actor:give_info_portion("snpt_bar1_done")

	elseif section == "n_inventory_box_bar2" then
		db.actor:give_info_portion("snpt_bar2_done")

	elseif section == "n_inventory_box_gen2" then
		amk.remove_item_from_inventory_by_name("gena_note3",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_x83",vector():set(-93.740013122559,-15.946046447754,112.18583679199),1380,3837)

	elseif section == "n_inventory_box_hospital2" then
		kostya_dialog.delete_teleport("fli99_tp3")

	elseif section == "n_inventory_box_warlab1" then
		db.actor:give_info_portion("snpt_warlab1_done")

	elseif section == "n_inventory_box_zaton1" then
		sak.set_mark_on_tajnik("n_inventory_box_zaton1_2",vector():set(-394.79879760742,53.038612365723,-337.77597045898),185627,3664)

	elseif section == "n_inventory_box_zaton1_2" then
		amk.remove_item_from_inventory_by_name("fli_note14",db.actor)

	elseif section == "n_inventory_box_zaton3" then
		db.actor:give_info_portion("snpt_zaton1_done")
		kostya_dialog.create_teleport("snp_zaton_tp1", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())

	elseif section == "n_inventory_box_zaton5" then
		db.actor:give_info_portion("snpt_zaton3_done")

	elseif section == "n_inventory_box_zaton6" then
		db.actor:give_info_portion("snpt_zaton4_done")

	elseif section == "n_inventory_box_hospital3" then
		db.actor:give_info_portion("snpt_hospital1_done")

	elseif section == "n_inventory_box_x181" then
		db.actor:give_info_portion("snpt_x181_done")

	elseif section == "n_inventory_box_x162" then
		db.actor:give_info_portion("snpt_x161_done")
		db.actor:give_info_portion("snp_video_arhiv_done")
		archievements.acv_task()
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."АННА:".."\\n".."%c[255,255,128,128]Дядя Стрелок, тут сталкер один зашёл недавно на Скадовск. Говорит, что он настоящий профессионал в деле прятания тайников, что наслышан про вас и хочет лично с вами познакомиться. Сказал, что таких тайников, какие есть у него, вы ещё не видели.".."\n", 10, nil, 30000)
		if not has_alife_info("sidor_delo_done") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."АННА:".."\\n".."%c[255,255,128,128]Только он сказал, что если вы ещё не закончили все дела с Волазаром и не выполнили просьбу дяди Сидоровича разобраться с его плохими контактами, то он с вами говорить не будет - приходите, как все сделаете. А почему - я не знаю...".."\n", 20, nil, 40000)
		end
		local obj = alife():create("vesker_zaton",vector():set(128.0725402832,-7.3395228385925,189.58338928223),1186465,3686)
		set_stalker_story_id(obj,19933)
		
	elseif section == "n_inventory_box_yantar1" then
		x16_17()

	elseif section == "n_inventory_box_bum1" then
		amk.remove_item_from_inventory_by_name("gena_note4",db.actor)
		kostya_dialog.create_teleport("gena_tp1", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		amk.start_timer("run", 1, "snp.gena_oso1_start()")

	elseif string.find(section, "n_inventory_box_profi") then
		if     section == "n_inventory_box_profi1" then
			kostya_dialog.delete_teleport("snp_profi_tp1")
		elseif section == "n_inventory_box_profi2" then
			kostya_dialog.create_teleport("snp_profi_tp2", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		elseif section == "n_inventory_box_profi3" then
			kostya_dialog.delete_teleport("snp_profi_tp2")
		elseif section == "n_inventory_box_profi4" then
			kostya_dialog.delete_teleport("snp_profi_tp4")
		elseif section == "n_inventory_box_profi5" then
			kostya_dialog.delete_teleport("snp_profi_tp5_1")
			kostya_dialog.delete_teleport("snp_profi_tp5_2")
		elseif section == "n_inventory_box_profi6" then
			kostya_dialog.delete_teleport("snp_profi_tp6")
		end
		snp_spawn.all_letters()

	elseif section == "v_inventory_box0" then
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ВОЛАЗАР:".."\\n".."%c[255,255,128,128]Верно, это мой небольшой презент тебе, "..user_name().."! Пользуйся на своё усмотрение. Ты уже полностью прошёл игру, поэтому эта халява в виде полётов никак не испортит тебе впечатление от Зоны. Так что наслаждайся. И не забывай: во время полёта можно пользоваться любым оружием. Особенно рекомендую РПГ, шмели, гранаты, и вообще любое другое тяжёлое оружие - очень интересно выходит! Да, как наиграешься, не забудь - тебя ждёт Ариадна!".."\n", 3, nil, 40000)
		db.actor:give_info_portion("vol_info_temp")
		db.actor:give_info_portion("vol_fly")

	elseif section == "a_inventory_box24" then
		db.actor:give_info_portion("taynik_dimak_have")

	end
end

-- общий калбек на взятие предмета из тайника, вызывается из take_item_from_box, и только один раз, независимо от количества лоадов.
function check_treasure_item(obj)
	local se_obj
	local section = obj:section()
	if     section == "emb_container" then
		db.actor:give_info_portion("emb_container_have")
		
	elseif section == "emb_note25" then
		db.actor:give_info_portion("emb14")

	elseif section == "snp_almaz_note1" then
		alife():release(object_by_section_offline("suslov_marsh"))
		alife():create("snp_almaz_note2",vector():set(30.251602172852,-0.85134720802307,-27.375852584839),139607,2131)
	
	elseif section == "snp_almaz_note3" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note2",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz4",vector():set(-7.8711194992065,2.2752339839935,-27.166484832764),92225,2131)

	elseif section == "snp_almaz_note4" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note3",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz5",vector():set(-33.041538238525,5.4613304138184,-31.517143249512),65385,2132)

	elseif section == "snp_almaz_note5" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note4",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz6",vector():set(47.762790679932,8.6410655975342,-31.51616859436),156324,2137)
		
	elseif section == "snp_almaz_note6" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note5",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz7",vector():set(-18.499711990356,1.4957152605057,-25.481069564819),80006,2160)

	elseif section == "snp_almaz_note7" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note6",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz8",vector():set(44.441833496094,4.6751842498779,-25.246084213257),157056,2228)
		kostya_dialog.create_teleport("tele_almaz8",vector():set(48.973514556885,5.4608883857727,-17.918466567993),164628,2228)

	elseif section == "snp_almaz_note8" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note7",db.actor)
		create_restrictor(vector():set(-136.21276855469,12.617782592773,10.618383407593),3688,2252,2,"snp_spawn.n_inventory_box_almaz9")
		kostya_dialog.delete_teleport("tele_almaz8")

	elseif section == "snp_almaz_note9" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note8",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz10",vector():set(-208.36692810059,8.6610012054443,42.246055603027),4289,2252)

	elseif section == "snp_almaz_note10" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note9",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz11",vector():set(-216.12236022949,5.4740557670593,86.903327941895),78,2141)

	elseif section == "snp_almaz_note11" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note10",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz11a",vector():set(-50.975608825684,3.5477068424225,-289.13818359375),137857,3756)

	elseif section == "snp_almaz_note11a" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note11",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz12",vector():set(855.42320800781,8.4400463104248,64.832587585449),160821,2604)

	elseif section == "snp_almaz_note12" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note11a",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_almaz13",vector():set(86.640037536621,59.932830810547,116.73533630371),57849,2566)

	elseif section == "snp_almaz_note13" then
		amk.remove_item_from_inventory_by_name("snp_almaz_note12",db.actor)
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."КОТОБЕГЕМОТ:".."\\n".."%c[255,255,128,128]Похоже, ты нашёл все доспехи Монолита, которые тебе нужны. Теперь тебе нужно поговорить с Тенью Монолита. Он должен отдать тебе последний череп и сказать, где и как их нужно активировать.".."\n", 5, nil, 30000)
		
	elseif section == "snp_note11" then
		amk.remove_item_from_inventory_by_name("snp_note10",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_kl1_3",vector():set(-133.72560119629,-4.0903553962708,-153.58737182617),4283,3238)

	elseif section == "snp_note12" then
		amk.remove_item_from_inventory_by_name("snp_note11",db.actor)
		alife():create("snp_note13",vector():set(-200.10061645508,-0.75918161869049,-77.472457885742),3782,3238)
		
	elseif section == "snp_note26" then
		if has_alife_info("snp_tmp1") then
			db.actor:give_info_portion("snpt_jupiter2_have")
			amk_mod.spawn_military_tech_pack(alife():create("vehicle_btr",vector():set(-157.93148803711,26.787044525146,-469.19927978516),450749,3714) ,"vehicle_btr", "scripts\\snp\\btr.ltx")
			amk_mod.spawn_military_tech_pack(alife():create("vehicle_btr",vector():set(-116.92964172363,26.800518035889,-467.65985107422),523498,3714) ,"vehicle_btr", "scripts\\snp\\btr.ltx")
		else
			db.actor:give_info_portion("snpt_jupiter2_fail")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Записку нужно было доставать с полигона, что перед тобой. А ты пошёл каким-то иным путём, поэтому задание не засчитано.".."\n", nil, nil, 30000)
		end
		db.actor:give_info_portion("snp_tmp_reset")
		db.actor:disable_info_portion("snp_tmp_reset")
		
	elseif section == "snp_note27" then
		db.actor:give_info_portion("snpt_jupiter3_have1")
		
	elseif section == "snp_note29" then
		sak.set_mark_on_tajnik("n_inventory_box_vp5",vector():set(-111.72229003906,0.99149996042252,-103.54452514648),82836,3759)

	elseif section == "snp_note30" then
		amk.remove_item_from_inventory_by_name("snp_note29",db.actor)
		sak.set_mark_on_tajnik("n_inventory_box_vp6",vector():set(205.22360229492,-25.027803421021,-258.54818725586),419629,3765)

	elseif section == "snp_note45" then
		alife():release(alife():object(obj:id()))

	elseif section == "af_fobos" then
		if not has_alife_info("snpt_jupiter5_done") then
			db.actor:give_info_portion("snpt_jupiter5_done")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."БОРОДА:".."\\n".."%c[255,255,128,128]Здорово, что ты нашёл рюкзак! Но это не все. Нужно ещё выбраться из этой заварухи. Что-то мне подсказывает, что Монолит ещё вернётся... Пока ты лез за рюкзаком, я попросил Доцента, чтобы он перенастроил приборы вертолётов Монолита, чтобы они не видели тебя, хотя бы некоторое время. Но он сделал по другому. Он связался с оборудованием, что на антенне над тобой, и сделал под антенной невидимую для приборов зону. Думаю, она будет для тебя не лишней. Прячься в неё, похоже, сейчас будет настоящая жесть!".."\n", 3, nil, 30000)
			amk.start_timer("run",15,"snp_spawn.snpt_jupiter6_run1()")
		end

	elseif section == "af_kamen_udachy2" then
		if has_alife_info("snp_kamen_udachy_not_found") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ПРОПЕР СЕМИДЕСЯТЫЙ:".."\\n".."%c[255,255,128,128]Стрелок, ты добрался до тайника с использованием гравипушки. Но этот тайник берётся без неё. И вообще без подкладывания под ноги каких-либо предметов. Конечно, это непросто, иначе я бы не приберёг этот тайник тебе на подарок. Чтобы добраться до него без гравипушки и предметов, тебе вновь нужно применить нестандартное мышление, а также открыть для себя некоторые новые возможности по перемещению. А в случае более простого пути с использованием гравипушки и предметов Фенрир артефакт у тебя примет, но выполнение задания засчитано не будет.".."\n", nil, nil, 50000)
			db.actor:give_info_portion("snp_kamen_udachy_fail")
		end
		db.actor:give_info_portion("snp_kamen_udachy_have")

	elseif section == "snp_pftp" then
		if not has_alife_info("snp_pftp_have") then
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ПФТП:".."\\n".."%c[255,255,128,128]Функция фиксации теневой позиции для владельца ПФТП активирована. Во избежание нежелательных сбоев не убирайте прибор из активного слота. Следующая точка теневой позиции - Юпитер, вышка, указывающая на вагон. Время: 16.30.".."\n", nil, "nano", 50000)
			db.actor:give_info_portion("snp_pftp_have")
		end

	elseif section == "snp_pda_profi1" then
		alife():release(alife():object(obj:id()))
		for i=1,20 do
			alife():release(alife():object(db.actor:object("snp_profi"..tostring(i)):id()))
		end
		news_manager.send_tip(db.actor, "Файл с найденного ПДА скопирован в раздел \"Журнал\\Данные на КПК.\"", nil, "nano", 10000)
		kostya_dialog.delete_teleport("snp_profi_tp0")
		xr_sound.get_safe_sound_object([[snp\pripyat_1986]]):play_at_pos(db.actor, vector():set(0,30,0), 150, sound_object.s3d)
		db.actor:give_info_portion("snp_profi_done")

	elseif section == "fli_bomba" then
		fly_island.worker()

	elseif section == "fli_note7" then
		if has_alife_info("fli_have_3") and not has_alife_info("fli_have_4") then
			amk.start_timer("fli_teleport_actor", 10, "fli99_tp1")
			db.actor:give_info_portion("fli_have_4")
		end

	end
end

-- общий калбек на потерю предмета
function checking_dropped_item_snp(obj)
	local se_obj
	local section = obj:section()
	if     section == "snp_skull" then
		if has_alife_info("snp_almaz2") and
			not has_alife_info("snp_almaz_skull_droped") and
			level.name()=="av_peshera" and
			db.actor:position():distance_to(vector():set(174.08480834961,55.11833190918,386.01168823242)) < 2   -- позиция аномалии
		then
			db.actor:give_info_portion("snp_almaz_skull_droped")
			level.start_stop_menu(level.main_input_receiver(), true)
			amk.remove_item(obj)
			level.add_pp_effector("teleport.ppe", 1626, false)
			sak.out_item_all("snp_skull")
			amk.start_timer("run", 10, "snp_spawn.almaz_done()")
		end

	elseif section == "af_zvezda_proroka" then
		if has_alife_info("snp_proper7012_done") and not has_alife_info("snp_fenrir_resurrected") then
			fenrir_recurrection()
		end
	end
end

function borov1_done()
	amk.remove_item_from_inventory_by_name("snp_pda1",db.actor)
	alife():create("snp_note1",vector():set(60.209255218506,1.2669388055801,202.85401916504),67537,1412)
end

function kotobegemot1_done()
	amk.remove_item_from_inventory_by_name("snp_note1",db.actor)
	sak.set_mark_on_tajnik("n_inventory_box_dt1",vector():set(-151.89974975586,0.057822465896606,82.370269775391),67331,1414)
end
function kotobegemot2_done()
	sak.set_mark_on_tajnik("n_inventory_box_uagro1",vector():set(-80.046859436035,0.33554920554161,-74.513531799316),2743,717)
	sak.set_mark_on_tajnik("n_inventory_box_uagro2",vector():set(-76.056887817383,5.0370149612427,-71.1019128418),3053,717)
end
function kotobegemot3_done()
	create_trup("suslov_marsh",vector():set(-179.94078063965,-1.9289412498474,-317.0966796875),50507,3365,19910)
	create_restrictor(vector():set(-179.94078063965,-1.9289412498474,-317.0966796875),50507,3365,5,"snp_spawn.suslov_marsh_sms1")
end
function kotobegemot4_done()
	sak.create_items_actor("wpn_mp5_m5",1)
	sak.create_items_actor("ammo_5.7x28_ap",2)
	sak.set_mark_on_tajnik("n_inventory_box_sd1",vector():set(31.474922180176,-2.0732517242432,-0.33933609724045),23315,3332)
end
function kotobegemot5_done()
	sak.set_mark_on_tajnik("n_inventory_box_zaton6",vector():set(472.22393798828,45.309955596924,32.999851226807),1732117,3693)
end

function fenrir1_done()
	local obj = create_item_and_restrictor("n_inventory_box_kordon1",vector():set(-279.7380065918,-0.36574172973633,-54.755081176758),771,66)
	amk.add_spot_on_map(obj.id,"crlc_big","Лёжка Фенрира") 
end
function fenrir2_done()
	sak.set_mark_on_tajnik("n_inventory_box_vp1",vector():set(152.8119354248,35.794906616211,192.96481323242),366789,3769)
	sak.set_mark_on_tajnik("n_inventory_box_vp3",vector():set(112.70432434082,7.9362993240356,230.14178771973),336187,3763)
	alife():create("snp_pda13",vector():set(137.0463104248,28.907472610474,241.01393127441),365077,3769)
end
function fenrir3_done()
	db.actor:give_info_portion("snp_tmp_reset")
	db.actor:disable_info_portion("snp_tmp_reset")
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."КОТОБЕГЕМОТ:".."\\n".."%c[255,255,128,128]Стрелок, надо встретиться, жду тебя в баре.".."\n", 2, nil, 30000)
	create_item_and_restrictor("n_inventory_box_limansk1",vector():set(-15.645086288452,31.041418075562,204.26181030273),18361,3010)
end
function fenrir5_done()
	create_item_and_restrictor("n_inventory_box_sd2",vector():set(-68.083503723145,16.592102050781,16.235578536987),11195,3326)
end
function fenrir6_done()
	create_restrictor(vector():set(111.94484710693,26.06196975708,206.38247680664),222943,2163,8,"snp_spawn.n_inventory_box_cp1")
end
function fenrir7_done()
	alife():create("snp_pda4",vector():set(89.451782226563,8.0235919952393,-36.271701812744),40758,3336)
end
function fenrir8_done()
	sak.set_mark_on_tajnik("n_inventory_box_limansk2",vector():set(153.16612243652,-3.9684197902679,191.56245422363),48566,3010)
end
function fenrir9_done()
	sak.set_mark_on_tajnik("n_inventory_box_pp1",vector():set(34.707355499268,26.599336624146,-34.705635070801),19879,3797)
end
function fenrir10_done()
	sak.out_item_namber("snp_pda5",1)
end
function fenrir11_done()
	kostya_dialog.create_teleport("snp_dt_tp1",vector():set(-301.47937011719,13.978932380676,-11.043887138367),4079,1392)
end
function fenrir12_done()
	create_item_and_restrictor("n_inventory_box_garbage1",vector():set(-43.013954162598,15.852832794189,-192.50405883789),146745,267)
	create_item_and_restrictor("n_inventory_box_garbage2",vector():set(-140.48768615723,11.519528388977,-4.1077198982239),76863,320)
end
function fenrir14_done()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."АННА:".."\\n".."%c[255,255,128,128]Спасибо вам, дядя Стрелок! Простите, что накричала на вас!".."\n", 3, nil, 30000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Ничего, малышка. Я сам виноват.".."\n", 9, nil, 30000)
end
function fenrir15_done()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."АННА:".."\\n".."%c[255,255,128,128]Милый, давай Стрелка на свадьбу пригласим?".."\n", 3, nil, 30000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Обязательно пригласим.".."\n", 9, nil, 30000)
	alife():create("wolffrend_zaton2",vector():set(244.71939086914,18.52823638916,530.84967041016),1385170,3687)
	local obj = alife():create("wolffrend_talk_zaton2",vector():set(244.79071044922,18.458442687988,530.23742675781),1385169,3687)
	set_stalker_story_id(obj,19924)
	create_restrictor(vector():set(244.71939086914,18.52823638916,530.84967041016),1385170,3687,20,"snp_spawn.snp_found_vogak")
end
function fenrir16_done()
	sak.set_mark_on_tajnik("n_inventory_box_x181",vector():set(5.69282579422,-6.828028678894,-5.3396325111389),3531,1135)
	create_restrictor(vector():set(9.7957534790039,-7.004012298634,-3.883784532547),4183,1135,2,"snp_spawn.n_inventory_box_x181_1")
end

function wolffrend3_done()
	news_manager.send_tip(db.actor, "Получена информация", nil, nil, 20000)
	snp_shadow.worker()
end

function bibliofrend1_done()
	sak.set_mark_on_tajnik("n_inventory_box_td1",vector():set(43.687808990479,8.059473991394,-48.321968078613),229941,1075)
	sak.set_mark_on_tajnik("n_inventory_box_td1",vector():set(49.53458404541,4.5404696464539,-24.940389633179),236607,1088)
end
function bibliofrend2_done()
	sak.set_mark_on_tajnik("n_inventory_box_td2",vector():set(-134.16679382324,42.907382965088,-239.34454345703),24281,851)
end

function bibliofrend_black2_done()
	sak.out_item_namber("snp_prime_maz_green",1)
	sak.out_item_namber("snp_prime_tabletki",1)
end

function resident_evil2_done()
	sak.set_mark_on_tajnik("n_inventory_box_cp2",vector():set(209.30194091797,12.337078094482,98.220161437988),257446,2145)
end
function resident_evil3_done()
	local obj = create_restrictor(vector():set(64.295387268066,14.247812271118,141.46493530273),235901,364,1,"snp_spawn.snp_receipt_parts2_1")
	amk.add_spot_on_map(obj.id,"crlc_big","Начало поисков второй части рецепта")
	amk.save_variable("snp_spot_id",obj.id)
end
function resident_evil4_done()
	sak.set_mark_on_tajnik("n_inventory_box_x161",vector():set(19.222473144531,2.6730494499207,10.203114509583),4529,1537)
end
function resident_evil7_done()
	sak.set_mark_on_tajnik("n_inventory_box_2chaes1",vector():set(888.90844726563,18.115972518921,308.2389831543),165937,2615)
end
function resident_evil8_done()
	news_manager.send_tip(db.actor, "Получена информация", nil, nil, 20000)
	sak.set_mark_on_tajnik("n_inventory_box_as1",vector():set(18.167123794556,-5.2449584007263,436.44525146484),365693,1808)
end
function resident_evil9_done()
	sak.set_mark_on_tajnik("n_inventory_box_jupiter2",vector():set(-123.60357666016,54.307857513428,-507.89172363281),530956,3714)
	create_restrictor(vector():set(-131.71226501465,33.441413879395,-495.35614013672),496987,3714,3,"snp_spawn.n_inventory_box_jupiter2")
end
function resident_evil10_done()
	sak.set_mark_on_tajnik("n_inventory_box_jupiter7",vector():set(-441.31995117188,13.287659645081,313.96146850586),3006,3701)
	snp_spawn.n_inventory_box_agro1()
end
function resident_evil11_done()
	create_restrictor(vector():set(-173.85223388672,24.41708946228,46.521488189697),162421,3600,3,"snp.spawn_brodaga")
end
function resident_evil12_done()
	news_manager.send_tip(db.actor, "Получена информация", nil, nil, 20000)
	sak.set_mark_on_tajnik("n_inventory_box_sarcofag1",vector():set(31.045442581177,21.825170516968,10.412265777588),6350,2423)
end
function resident_evil13_done()
	create_restrictor(vector():set(-36.414665222168,-8.9850168228149,-38.975612640381),140,3155,1,"snp_spawn.n_inventory_box_warlab1")
end

function proper70_start_done1()
	drink_vodka()
	amk.start_timer("run2",4,"snp.proper70_start_done2()")
end
function proper70_start_done2()
	level.add_cam_effector("camera_effects\\radar_stop.anm", 2506, false, "")
	amk.start_timer("run2",14,"snp.proper70_start_done3()")
end
function proper70_start_done3()
	sleep_manager.main(3+amk.load_variable("gg_need_sleep_nrg",0))
	amk.start_timer("run2",2,"snp.proper70_start_done4()")
end
function proper70_start_done4()
	local obj = object_by_section("proper70_limansk")
	if obj then
		alife():release(alife():object(obj:id()))
	end
	sak.set_mark_on_tajnik("n_inventory_box_limansk3",vector():set(-64.228126525879,-0.44177567958832,-133.02131652832),1016,2996)
end
function proper70_sms1()
	local text = "%c[255,160,160,160]".."ПРОПЕР СЕМИДЕСЯТЫЙ:".."\\n".."%c[255,255,128,128]Стрелок, жду тебя в бункере ученых на Юпитере.".."\n"
	db.actor:give_talk_message(text, "ui\\ui_iconsTotal", Frect():set(0,658,83,47), "iconed_answer_item")
	news_manager.send_tip(db.actor, text, nil, nil, 30000)
end
function proper701_done()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."АННА:".."\\n".."%c[255,255,128,128]Стрелок, ничего сказать мне не хочешь?".."\n", 2, nil, 30000)
end
function proper703_done()
	alife():release(object_by_section_offline("snp_semetskiy"))
	create_restrictor(vector():set(-100.15243530273,-1.140389919281,-16.317848205566),243214,3620,1,"snp.gena_start")
end
function proper705_done()
	sak.set_mark_on_tajnik("n_inventory_box_jupiter3",vector():set(0.0003257321077399,9.8299655914307,173.87929992676),716376,3724)
end
function proper706_have()
	sak.out_item_all("snp_pda7")
	alife():release(object_by_section_offline("snp_ucheniy1"))
end
function proper7010_done()
	kostya_dialog.create_teleport("tele_limansk5",vector():set(44.667556762695,3.6490089893341,340.65399169922),52431,3025)
end
function proper7012_done()
	sak.create_items_actor("af_zvezda_proroka",1)
	amk.del_variable("snp_make_zp")
end
function proper7013_done()
	news_manager.send_tip(db.actor, "Получена информация", nil, nil, 20000)
	sak.set_mark_on_tajnik("n_inventory_box_zaton2",vector():set(203.38031005859,54.482738494873,20.770593643188),1317929,3684)
end
function proper7014_done()
--	amk.remove_item_from_inventory_by_name("snp_pftp",db.actor)
end
function proper7015_done()
	sak.set_mark_on_tajnik("n_inventory_box_x162",vector():set(113.93637084961,38.142959594727,-17.945663757324),7084,1543)
end

function anna1_done()
	sak.set_mark_on_tajnik("n_inventory_box_x81",vector():set(-111.18604278564,-32.319286346436,87.424247741699),257,3832)
	snp_spawn.n_inventory_box_x81()
end
function anna4_done()
	sak.set_mark_on_tajnik("n_inventory_box_kordon5",vector():set(20.258415222168,19.372343063354,709.37756347656),297580,1)
end

function ludmila_start_done()
	create_trup("snp_ucheniy2",vector():set(10.804178237915,37.729103088379,64.052787780762),91279,2575,19919)
end
function ludmila1_done()
	alife():release(object_by_section_offline("snp_ucheniy2"))
	sak.set_mark_on_tajnik("n_inventory_box_vp4",vector():set(-44.927261352539,7.6782546043396,-95.03076171875),143417,3759)
end
function ludmila2_done()
	sak.set_mark_on_tajnik("n_inventory_box_x82",vector():set(-71.280982971191,-5.6220226287842,70.717254638672),4851,3841)
end

function ariadna3_done()
	game.start_tutorial("finish_dopa_dream")
end
function ariadna_talk()
	db.actor:run_talk_dialog(object_by_section("ariadna_zaton"))
end
function ariadna4_done()
    db.actor:hide_weapon()
    level.disable_input()
	amk.start_timer("run",4,"snp.op2_done1()")
end

function op2_done1()
	alife():release(alife():object(object_by_section("skadovsk_radio"):id()))
	xr_sound.stop_all_sound_object()
	level.add_pp_effector("agr_u_fade.ppe", 2009, false)
	level.hide_indicators()
	amk.start_timer("run",5.5,"snp.op2_done2()")
end
function op2_done2()
	local f = getFS()
	if f:exist("$game_saves$", "credits.ltx") == nil then
		local f1 = f:update_path("$game_saves$", "game_setup.ltx")
		local f2 = f:update_path("$game_saves$", "credits.ltx")
		f:file_copy(f1, f2)
	end

	xr_effects.game_credits()
end

function lobsang1_done()
	alife():create("snp_note20",vector():set(-123.56,2.64,-265.17),71235,3752)
end
function lobsang2_done()
	sak.set_mark_on_tajnik("n_inventory_box_zaton3",vector():set(322.16027832031,31.884847640991,-509.40014648438),1661631,3694)
end

function brodaga_start_done()
	kostya_dialog.create_teleport("snp_mg_tp1",db.actor:position(),db.actor:level_vertex_id(),db.actor:game_vertex_id())
end
function brodaga1_done()
	create_restrictor(vector():set(152.49157714844,10.798604011536,135.94035339355),39883,1204,1,"snp_spawn.snpt_bar1_restr1")
end
function brodaga2_done()
	create_restrictor(vector():set(134.34739685059,1.77443754673,209.43351745605),945793,3732,80,"snp_spawn.snpt_jupiter4_restr1")
	create_restrictor(vector():set(155.5616607666,1.2630597352982,217.27157592773),981446,3732,1,"snp_spawn.snpt_jupiter4_restr2")
	create_restrictor(vector():set(166.08932495117,-1.0351370573044,216.90351867676),996813,3732,0.5,"snp_spawn.snpt_jupiter4_restr3")
end
function brodaga3_done()
	sak.set_mark_on_tajnik("n_inventory_box_hospital3",vector():set(-92.732971191406,36.388934326172,718.83197021484),1801,3034)
end

function boroda_start_done()
	create_restrictor(vector():set(398.89025878906,42.905143737793,-186.23631286621),1344338,3743,1,"snp_spawn.snpt_jupiter5_run0")
end
function boroda2_done()
	sak.set_mark_on_tajnik("n_inventory_box_bar2",vector():set(157.58059692383,2.3406450748444,99.714075622559),41404,1210)
end

function bubulyka1_done()
	sak.set_mark_on_tajnik("n_inventory_box_x101",vector():set(-35.10555267334,-12.319800376892,38.615665435791),1883,2740)
end
function bubulyka2_done()
	alife():create("snp_plan",vector():set(127.46975708008,15.725096702576,-85.388702392578),8868,3329)
	sak.set_mark_on_tajnik("n_inventory_box_sd3",vector():set(5.2320046424866,14.60878944397,123.88447570801),4986,3326)
end
function bubulyka3_done()
	sak.set_mark_on_tajnik("n_inventory_box_jupiter1",vector():set(223.76635742188,-27.385223388672,118.8678894043),1099877,3740)
	create_restrictor(vector():set(225.84899902344,-7.6801772117615,121.92847442627),1103327,3740,5,"snp_spawn.n_inventory_box_jupiter1")
end
function bubulyka5_done()
	create_trup("snp_semetskiy",vector():set(-8.7067518234253,2.8850204944611,-137.86454772949),20691,2993,19912)
end
function bubulyka7_done()
	sak.set_mark_on_tajnik("n_inventory_box_zaton5",vector():set(-474.8293762207,49.513092041016,-363.09838867188),307427,3664)
end

function sviblov1_done()
	sak.set_mark_on_tajnik("n_inventory_box_almaz1",vector():set(-323.99597167969,23.688106536865,504.12481689453),12873,3361)
end

function monolith1_done()
	local obj = sak.set_mark_on_tajnik("n_inventory_box_almaz14",vector():set(-108.42949676514,40.053085327148,479.11297607422),151147,2987)
	start_sound()
end

function kalmyk1_done()
	sak.create_items_actor("snp_prime_maz",1)
end

function ginekolog1_done()
	sak.create_items_actor("snp_prime_tabletki",1)
end

function sakharov1_done()
	create_trup("snp_ucheniy1",vector():set(150.7462310791,12.494668960571,291.85235595703),66667,2546,19913)
end

function klenov1_done()
	alife():create("snp_pda9",vector():set(109.70481872559,4.0410284996033,131.71212768555),227060,2173)
end

function osvedomitel1_done()
	sak.create_items_actor("karta_peschera",1)
end

function docent1_done()
	create_restrictor(vector():set(342.96533203125,-10.53200340271,265.6682434082),487247,3769,1,"snp_spawn.n_inventory_box_vp7")
	create_restrictor(vector():set(-149.70997619629,0.07987043261528,-325.49044799805),8641,3241,2,"snp_spawn.n_inventory_box_kl3")
	sak.set_mark_on_tajnik("n_inventory_box_vp7",vector():set(438.14892578125,-3.9284706115723,348.73168945313),487247,3769)
	sak.set_mark_on_tajnik("n_inventory_box_vp8",vector():set(448.04238891602,-9.7089061737061,152.36047363281),487248,3769)
	sak.set_mark_on_tajnik("n_inventory_box_vp9",vector():set(117.89761352539,3.7252898216248,-163.28845214844),345653,3765)
	sak.set_mark_on_tajnik("n_inventory_box_kl3",vector():set(-151.22601318359,4.3636498451233,-330.02380371094),6006,3239)
	sak.set_mark_on_tajnik("n_inventory_box_kl4",vector():set(-200.62432617188,0.13194620609283,-333.20723632813),614,3231)
end
function docent2_done()
	sak.create_items_actor("bioradar2",1)
end
function docent4_done()
	sak.create_items_actor("snp_rings",1)
	sak.create_items_actor("bullion_gild",1)
	amk.del_variable("snp_make_rings")
end

function snpt_kordon1_done()
	amk.remove_item_from_inventory_by_name("snp_pda2",db.actor)
	amk.remove_item_from_inventory_by_name("snp_note2",db.actor)
end
function snpt_limansk4_done()
	sak.out_item_all("snp_note25")
	sak.out_item_all("snp_receipt")
end
function snpt_x101_done()
	sak.out_item_namber("snp_note8",1)
end
function snpt_sd1_done()
	sak.out_item_namber("snp_plan",1)
end
function snpt_sd4_done()
	amk.remove_item_from_inventory_by_name("snp_pda4",db.actor)
end
function snpt_cp2_done()
	sak.out_item_all("snp_pda9")
end
function snpt_garbage1_done()
	amk.remove_item_from_inventory_by_name("snp_note16",db.actor)
end
function snpt_jupiter3_have2()
	sak.out_item_all("snp_note27")
end
function snpt_mg2_done()
	amk.remove_item_from_inventory_by_name("snp_note28",db.actor)
	amk.remove_item_from_inventory_by_name("snp_pda8",db.actor)
	aem_manager.manage_money(500000, "in")
end
function snpt_kl1_done()
	sak.out_item_all("snp_note31")
end
function snpt_2chaes3_done()
	sak.out_item_all("snp_pda14")
end

function receipt_parts1_done()
	amk.remove_item_from_inventory_by_name("snp_note18",db.actor)
end

function spawn_fenrir_resident()
	local obj
	if has_alife_info("snp_kotobegemot2_done") and has_alife_info("doki_dimak_done") then
		alife():create("skadovsk_radio",vector():set(123.99,-5.22,175.61),1180491,3686)
		obj = alife():create("fenrir_zaton",vector():set(138.73059082031,-7.3394303321838,178.58042907715),1203766,3686)
		set_stalker_story_id(obj,19902)
		alife():create("wolffrend_zaton",vector():set(137.85824584961,-7.3402981758118,176.09548950195),1202652,3686)
		obj = alife():create("wolffrend_talk_zaton",vector():set(137.19732666016,-7.3405375480652,176.83992004395),1201535,3686)
		set_stalker_story_id(obj,19925)
		obj = alife():create("resident_evil_zaton",vector():set(125.20777893066,-7.3201112747192,181.31158447266),1181686,3686)
		set_stalker_story_id(obj,19903)
		alife():create("bibliofrend_zaton",vector():set(123.07048034668,-7.3236355781555,177.8239440918),1178118,3686)
		obj = alife():create("bibliofrend_talk_zaton",vector():set(124.68988037109,-7.3328924179077,177.81799316406),1180494,3686)
		set_stalker_story_id(obj,19926)
		obj = alife():create("anna_zaton",vector():set(130.02600097656,-7.3398327827454,177.09588623047),1189961,3686)
		set_stalker_story_id(obj,19904)
		obj = alife():create("bubulyka_zaton",vector():set(125.23503112793,-7.3206615447998,189.49803161621),1181710,3686)
		set_stalker_story_id(obj,19905)
		sak.set_mark_on_tajnik("n_inventory_box_jupiter9",vector():set(-395.90551757813,7.129807472229,8.7594566345215),53666,3708)
		sak.set_mark_on_tajnik("n_inventory_box_jupiter10",vector():set(-394.78768920898,11.417579650879,-16.300596237183),51619,3708)
		sak.set_mark_on_tajnik("n_inventory_box_jupiter12",vector():set(-400.90841674805,8.9562080001831,-372.55517578125),43101,3702)
		alife():create("yashik_smeley",vector():set(-390.25207519531,11.416480064392,-15.570077896118),58648,3708)
		alife():create("yashik_smeley",vector():set(-390.9560546875,11.416576385498,-15.566843032837),57648,3708)
		alife():create("yashik_smeley",vector():set(-391.61871337891,11.416634559631,-15.565946578979),57648,3708)
		alife():create("yashik_smeley",vector():set(-392.30261230469,11.416634559631,-15.56485748291),56659,3708)
	end
end

function fenrir_gone()
	db.actor:give_info_portion("snp_fenrir13_done")
	create_restrictor(vector():set(-62.68639755249,-0.44013518095016,-138.39880371094),1086,2996,1,"snp_spawn.n_inventory_box_limansk3")
end

function spawn_bunker_jupiter()
	local obj
	local obj
	obj = object_by_section_offline("fenrir_2chaes")
	if obj then
		alife():release(obj)
	end
	alife():release(object_by_section_offline("resident_evil_zaton"))
	alife():release(object_by_section_offline("anna_zaton"))
	create_trup("fenrir_jupiter",vector():set(-223.81423950195,-2.3742883205414,83.036392211914),335931,3708,19911)
	obj = alife():create("proper70_jupiter",vector():set(-227.50967407227,-3.3744874000549,79.343292236328),331133,3708)
	set_stalker_story_id(obj,19907)
	obj = alife():create("resident_evil_jupiter",vector():set(-223.96179199219,-3.5705282688141,78.559143066406),337165,3708)
	set_stalker_story_id(obj,19908)
	obj = alife():create("anna_jupiter",vector():set(-222.07434082031,-3.3452470302582,83.116653442383),340907,3708)
	set_stalker_story_id(obj,19909)
	db.actor:give_info_portion("snp_anna2_done")
end

function spawn_brodaga()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Стрелок, только что получил сообщение от Бродяги. Нет его на лёжке. Что-то случилось, он в подвале какого-то дома. Найди его, он долго не протянет.".."\n", nil, nil, 20000)
	create_wounded("brodaga_mg",vector():set(-79.084762573242,0.13354560732841,156.9275970459),266398,3621)
	new_dialog.create_items(db.actor,"medkit",1)
end

function brodaga_give_medkit(first_speaker, second_speaker)
	if not has_alife_info("snpt_mg1_done") then 
		dialogs.transfer_medkit(first_speaker, second_speaker)
		db.actor:give_info_portion("snpt_mg1_done")
	end
end

function move_ariadna_to_bar()
	if has_alife_info("snpt_kl1_have1") and has_alife_info("snpt_kl1_have2") then
		local obj = object_by_section_offline("marsh_ariadna2")
		if obj then
			alife():release(obj)
		else
			obj = object_by_section_offline("marsh_ariadna")
			if obj then
				alife():release(obj)
			end
		end
		obj = alife():create("ariadna_bar",vector():set(115.2995300293,-5.3040218353271,12.653481483459),33757,1239)
		set_stalker_story_id(obj,19917)
	end
end

-- Вертолеты в ВП
function heli_vp1()
	heli_vp1_done(1)
end
function heli_vp2()
	heli_vp1_done(2)
end
function heli_vp3()
	heli_vp1_done(3)
end
function heli_vp4()
	heli_vp1_done(4)
end
function heli_vp5()
	heli_vp1_done(5)
end
function heli_vp6()
	heli_vp1_done(6)
end
function heli_vp1_done(num)
	db.actor:give_info_portion("snp_tmp"..tostring(num))
	if  has_alife_info("snp_tmp1") and has_alife_info("snp_tmp2") and has_alife_info("snp_tmp3") and has_alife_info("snp_tmp4") and has_alife_info("snp_tmp5") and has_alife_info("snp_tmp6") then
		if not has_alife_info("snpt_vp1_have") then
			db.actor:give_info_portion("snpt_vp1_have")
			db.actor:disable_info_portion("no_teleport_near_heli_btr")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Молодец, братишка! У меня для тебя бонус за хорошую работу. Ищи его на кинотеатре \"Прометей\".".."\n", nil, nil, 30000)
			sak.set_mark_on_tajnik("n_inventory_box_vp1_2",vector():set(101.78779602051,16.476371765137,378.32775878906),321990,3760)
			alife():create("zone_ozero",vector():set(58.848209381104,1.0079244375229,367.44982910156),276095,3760)
		end
	end
end
function heli_vp1_fail()
	if not has_alife_info("snpt_vp1_have") then
		db.actor:give_info_portion("snp_tmp_reset")
		db.actor:disable_info_portion("snp_tmp_reset")
		db.actor:give_info_portion("snpt_vp1_fail")
	end
end

-- стрелял в вульфа - враг Фенриру
function actor_shoot_wolffrend()
	local obj
	if not has_alife_info("fenrir_enemy") then 
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Зачем ты стрелял в моего лучшего друга? Это мирное животное, к людям он всегда был дружелюбен и на тебя не нападал - я его так научил. Теперь ты мне враг.".."\n", nil, nil, 30000)
		obj = object_by_section("wolffrend_talk_zaton")
		if obj then
			alife():release(alife():object(obj:id()))
		end
		relation_registry.set_community_goodwill ("stalker", "actor", -5000)
		db.actor:set_character_community("monolith", 0, 0)
		db.actor:give_info_portion("fenrir_enemy")
	end
end

-- стрелял в библика - враг Обители Зла
function actor_shoot_bibliofrend()
	local obj
	if not has_alife_info("resident_evil_enemy") then 
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Зачем ты стрелял в моего лучшего друга? Это мирное животное, к людям он всегда был дружелюбен и на тебя не нападал - я его так научил. Теперь ты мне враг.".."\n", nil, nil, 30000)
		obj = object_by_section("bibliofrend_talk_zaton")
		if obj then
			alife():release(alife():object(obj:id()))
		end
		relation_registry.set_community_goodwill ("stalker", "actor", -5000)
		db.actor:set_character_community("monolith", 0, 0)
		db.actor:give_info_portion("resident_evil_enemy")
	end
end

-- воскрешение Фенрира
local fenrir = nil
function fenrir_recurrection()
	local art = object_by_section_nobinder("af_zvezda_proroka")
	fenrir = object_by_section("fenrir_jupiter")
	if art:position():distance_to(fenrir:position()) > 2.5 then return end
	
	level.start_stop_menu(level.main_input_receiver(), true)
	xr_effects.disable_ui()
	amk.remove_item(art)
	level.add_cam_effector("camera_effects\\radar_stop.anm", 2920, false, "")
	local snd = xr_sound.get_safe_sound_object("ambient\\sparks1")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run4",snd:length()/1000+1,"snp.fenrir_recurrection2()")
	amk.start_timer("run5",15,"snp.fenrir_recurrection5()")
end
function fenrir_recurrection2()
	level.add_pp_effector("teleport.ppe", 2921, false)
	local snd = xr_sound.get_safe_sound_object("ambient\\mon_explosion")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run",0.5,"snp.fenrir_recurrection3()")
	amk.start_timer("run2",snd:length()/1000+2,"snp.fenrir_recurrection4()")
end
function fenrir_recurrection3()
	alife():release(alife():object(fenrir:id()))
	alife():release(alife():object(object_by_section("resident_evil_jupiter"):id()))
	alife():release(alife():object(object_by_section("anna_jupiter"):id()))
	db.actor:give_info_portion("teleport_started")
	db.actor:set_actor_position(vector():set(-223.79437255859,-3.5704712867737,78.461990356445))
	db.actor:set_actor_direction(0)
	db.actor:give_info_portion("teleport_finished")
	level.remove_cam_effector(2920)
	level.add_cam_effector("camera_effects\\radar_stop.anm", 2920, false, "")
end
function fenrir_recurrection4()
	xr_sound.get_safe_sound_object("ambient\\earthquake"):play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
function fenrir_recurrection5()
	level.add_pp_effector("agr_u_fade.ppe", 2923, false)
	amk.start_timer("run3",6,"snp.fenrir_recurrection6()")
end
function fenrir_recurrection6()
	level.remove_pp_effector(2923)
	level.add_pp_effector("deadcity_wake.ppe", 2924, false)
	local snd = xr_sound.get_safe_sound_object("ambient\\rnd_outdoor\\rnd_boar3")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run",snd:length()/1000+2,"snp.fenrir_recurrection7()")
end
function fenrir_recurrection7()
	level.remove_pp_effector(2924)
	level.add_pp_effector("deadcity_wake.ppe", 2924, false)
	local snd = xr_sound.get_safe_sound_object("ambient\\rnd_outdoor\\rnd_boar2")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run",snd:length()/1000+2,"snp.fenrir_recurrection8()")
end
function fenrir_recurrection8()
	level.remove_pp_effector(2924)
	level.add_pp_effector("deadcity_wake.ppe", 2924, false)
	local snd = xr_sound.get_safe_sound_object("ambient\\rnd_outdoor\\rnd_boar3")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run",snd:length()/1000+2,"snp.fenrir_recurrection9()")
end
function fenrir_recurrection9()
	level.remove_pp_effector(2924)
	level.add_pp_effector("deadcity_wake.ppe", 2924, false)
	local snd = xr_sound.get_safe_sound_object("ambient\\rnd_outdoor\\rnd_boar2")
	snd:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	amk.start_timer("run",snd:length()/1000+4,"snp.fenrir_recurrection10()")
end
function fenrir_recurrection10()
	local obj = alife():create("fenrir_jupiter",vector():set(-223.79888916016,-3.3462553024292,81.488891601563),337173,3708)
	set_stalker_story_id(obj,19911)
	xr_sound.get_safe_sound_object("ambient\\random\\rnd_respawn"):play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_cam_effector("camera_effects\\prison_1.anm", 2925, false, "")
	amk.start_timer("run",14,"snp.fenrir_recurrection11()")
end
function fenrir_recurrection11()
	xr_effects.enable_ui()
	db.actor:give_info_portion("snp_fenrir_resurrected")
end

-- Сборка биорадара
function snp_bioradar_parts_have_all()
	return
		new_dialog.item_much("mutant_spider_gland",1) and
		new_dialog.item_much("mutant_rotan_heart",1) and
		new_dialog.item_much("mutant_plague_hand",1) and
		new_dialog.item_much("mutant_carlic_hand",1) and
		new_dialog.item_much("mutant_vypolzen_hrebet",1) and
		new_dialog.item_much("mutant_raptor_kogot",1) and
		new_dialog.item_much("mutant_zanoza_leg",1) and
		new_dialog.item_much("mutant_flesh_eye",1) and
		new_dialog.item_much("mutant_boar_leg",1) and
		new_dialog.item_much("mutant_dog_tail",1) and
		new_dialog.item_much("mutant_psevdodog_tail",1) and
		new_dialog.item_much("mutant_krovosos_jaw",1) and
		new_dialog.item_much("mutant_burer_hand",1) and
		new_dialog.item_much("mutant_zombie_hand",1) and
		new_dialog.item_much("mutant_snork_leg",1) and
		new_dialog.item_much("mutant_face_tushkano",1) and
		new_dialog.item_much("mutant_hand_kontroler",1) and
		new_dialog.item_much("mutant_poltergeist_glas",1) and
		new_dialog.item_much("mutant_psevdogigant_hand",1) and
		new_dialog.item_much("mutant_tail_cat",1) and
		new_dialog.item_much("mutant_chimera_kogot",1) and
		new_dialog.item_much("mutant_fracture_hand",1) and
		new_dialog.item_much("mutant_deathclaw_antler",1) and
		new_dialog.item_much("part_digitis_biblio",1) and
		new_dialog.item_much("part_tarakan",1) and
		new_dialog.item_much("part_tarakan_strong",1) and
		new_dialog.item_much("mutant_zombie_teeth",1) and
		new_dialog.item_much("mutant_spleen_rat",1)
end		
function snp_bioradar_parts()
	if snp_bioradar_parts_have_all() then
		db.actor:give_info_portion("snp_bioradar_parts")
		return true
	end
end
function snp_bioradar_parts0_have_all()
	return
		new_dialog.item_much("bioradar",2)
end		
function snp_bioradar_parts0()
	if snp_bioradar_parts0_have_all() then
		db.actor:give_info_portion("snp_bioradar_parts0")
		return true
	end
end
function snp_bioradar_parts_done_have_all()
	return 
		snp_bioradar_parts_have_all() and
		snp_bioradar_parts0_have_all() and
		new_dialog.item_much("snpbiopart",4) and
		new_dialog.item_much("snp_biopart5",1) and
		new_dialog.item_much("snp_biopart6",1) and
		new_dialog.item_much("snp_biopart7",1)
end
function snp_bioradar_parts_done()
	if not has_alife_info("snp_bioradar_parts_done") then 
		sak.out_item_namber("mutant_spider_gland",1)
		sak.out_item_namber("mutant_rotan_heart",1)
		sak.out_item_namber("mutant_plague_hand",1)
		sak.out_item_namber("mutant_carlic_hand",1)
		sak.out_item_namber("mutant_vypolzen_hrebet",1)
		sak.out_item_namber("mutant_raptor_kogot",1)
		sak.out_item_namber("mutant_zanoza_leg",1)
		sak.out_item_namber("mutant_flesh_eye",1)
		sak.out_item_namber("mutant_boar_leg",1)
		sak.out_item_namber("mutant_dog_tail",1)
		sak.out_item_namber("mutant_psevdodog_tail",1)
		sak.out_item_namber("mutant_krovosos_jaw",1)
		sak.out_item_namber("mutant_burer_hand",1)
		sak.out_item_namber("mutant_zombie_hand",1)
		sak.out_item_namber("mutant_snork_leg",1)
		sak.out_item_namber("mutant_face_tushkano",1)
		sak.out_item_namber("mutant_hand_kontroler",1)
		sak.out_item_namber("mutant_poltergeist_glas",1)
		sak.out_item_namber("mutant_psevdogigant_hand",1)
		sak.out_item_namber("mutant_tail_cat",1)
		sak.out_item_namber("mutant_chimera_kogot",1)
		sak.out_item_namber("mutant_fracture_hand",1)
		sak.out_item_namber("mutant_deathclaw_antler",1)
		sak.out_item_namber("part_digitis_biblio",1)
		sak.out_item_namber("part_tarakan",1)
		sak.out_item_namber("part_tarakan_strong",1)
		sak.out_item_namber("mutant_zombie_teeth",1)
		sak.out_item_namber("mutant_spleen_rat",1)
		sak.out_item_namber("bioradar",2)
		sak.out_item_namber("snpbiopart",4)
		sak.out_item_namber("snp_biopart5",1)
		sak.out_item_namber("snp_biopart6",1)
		sak.out_item_namber("snp_biopart7",1)
		db.actor:give_info_portion("snp_bioradar_parts_done")
	end
end

-- Алмазные черепа
function snp_almaz_have()
	return
		new_dialog.item_much("snp_skull",13)
end
function snp_almaz_dospehi_have()
	return
		new_dialog.item_much("snp_suriken",1) and
		new_dialog.item_much("snp_suriken2",1) and
		new_dialog.item_much("snp_shield",1) and
		new_dialog.item_much("snp_sword",1)
end

-- Вступление в монолит по сюжету при входе в Лабиринт
function join_monolith()
	if  has_alife_info("snp_kotobegemot3_done") and
		not has_alife_info("snp_almaz_done") and 
		not db.actor:object("amulet") and
		level.name()=="av_peshera" and
		snp_almaz_dospehi_have()
	then
		db.actor:set_character_community("monolith", 0, 0)
	end
end

-- колбы
function make_four_kolba_have()
	if has_alife_info("snp_proper703_done") and
		new_dialog.item_much("kolba_krasn_poln",4) then
		
		db.actor:give_info_portion("snp_make_four_kolba_have")
		return true
	end
end
function make_four_kolba_done()
	sak.out_item_namber("kolba_krasn_poln",4)
end

-- части Звезды Пророка
function zvezda_parts1_have()
	if has_alife_info("snp_proper706_done") and
		new_dialog.item_much("af_gelion",1) and
		new_dialog.item_much("artifact_electro_crystal_thorn",1) and
		new_dialog.item_much("af_spiral",1)	then
		
			db.actor:give_info_portion("snp_zvezda_parts1_have")
		return true
	end
end
function zvezda_parts1_done()
	sak.out_item_namber("af_gelion",1)
	sak.out_item_namber("artifact_electro_crystal_thorn",1)
	sak.out_item_namber("af_spiral",1)
end
function zvezda_parts2_have()
	if has_alife_info("snp_proper708_done") and
		new_dialog.item_much("af_fobos",1) and
		new_dialog.item_much("gold_art",7) and
		new_dialog.item_much("af_part_monolit",1) then
		
			db.actor:give_info_portion("snp_zvezda_parts2_have")
		return true
	end
end
function zvezda_parts2_done()
	sak.out_item_namber("af_fobos",1)
	sak.out_item_namber("gold_art",7)
	sak.out_item_namber("af_part_monolit",1)
	
	local obj = alife():create("ludmila_zaton",vector():set(130.02600097656,-7.3398327827454,177.09588623047),1189961,3686)
	set_stalker_story_id(obj,19916)
end
function zvezda_parts3_have()
	if has_alife_info("snp_proper7010_done") and
		new_dialog.item_much("af_encelad",1) and
		new_dialog.item_much("af_life_heart",5) and
		new_dialog.item_much("af_buliz",30) and
		new_dialog.item_much("art_acumm",50) then
		
			db.actor:give_info_portion("snp_zvezda_parts3_have")
		return true
	end
end
function zvezda_parts3_done()
	sak.out_item_namber("af_encelad",1)
	sak.out_item_namber("af_life_heart",5)
	sak.out_item_namber("af_buliz",30)
	sak.out_item_namber("art_acumm",50)
	amk.save_variable("snp_make_zp", amk.game_minutes()+10)
end
function zp_ready()
	return has_alife_info("snp_proper7011_done") and not has_alife_info("snp_proper7012_done") and amk.game_minutes() > amk.load_variable("snp_make_zp", 0)
end

-- Камень Удачи
function kamen_udachy_have()
	return has_alife_info("snp_fenrir14_done") and db.actor:object("af_kamen_udachy2")
end
function kamen_udachy_done()
	sak.out_item_namber("af_kamen_udachy2",1)
end

-- Эмбрион вульфа
function embrion_vogak_have()
	return has_alife_info("snp_wolffrend2_done") and db.actor:object("mutant_wolf_cocoon")
end
function embrion_vogak_done()
	sak.out_item_namber("mutant_wolf_cocoon",1)
end

-- Завершение Звезды Пророка
function zvezda_proroka_done()
	local obj
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Ну, вот и все, "..user_name()..". Ты достиг невозможного. Теперь ты - единственный в Зоне, кто смог постичь непостижимое. Надеюсь, в твоей не вымышленной, а настоящей, реальной, насыщенной не меньшими чудесами жизни ты также сможешь добиться многого. Того, чего не смог добиться я. И откроешь ещё немало не выдуманных, а реальных, живых, настоящих тайн. А самое главное - приобретёшь бесценный опыт. Ведь ты превзошёл меня, а значит, ты - лучший!".."\n", 3, nil, 38000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ПРОПЕР СЕМИДЕСЯТЫЙ:".."\\n".."%c[255,255,128,128]Стрелок, зайди на Скадовск, похвастайся приобретением.".."\n", 45, nil, 20000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Поздравляю с находкой! Ну что, воришка: пока лазил по чужим квартирам, не потерял ещё записку с наводкой на мой бонусный тайник?".."\n", 50, nil, 20000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Нет, она у меня. Но там написано искать в трубе, и всё. А в какой трубе - непонятно.".."\n", 58, nil, 20000)
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ОБИТЕЛЬ ЗЛА:".."\\n".."%c[255,255,128,128]Суть в том, что когда я Юпитер покорял, хабара набрал немерено, и занесла меня нечистая в вентиляционный комплекс. Так вот: залез я туда, а когда дошёл до центрального зала, набежала куча псевдопсов, и начали рвать меня по самые мокасины. Вот я свой хабар и скинул там, а где - не помню. Пока я в спешке записывал наводку на листок бумаги, один из псевдопсов прыгнул на меня и оторвал половину листка. Но хабар точно там. Потому что если бы не скинул, то не говорил бы сейчас с тобой. Найди его и владей содержимым по своему усмотрению.".."\n", 66, nil, 40000)
	create_restrictor(vector():set(-192.9940032959,0.75845563411713,-274.79794311523),389153,3710,2,"snp_spawn.n_inventory_box_jupiter11_1")
	-- Возвращаем Вульфа на Скадовск
	alife():create("wolffrend_zaton",vector():set(137.85824584961,-7.3402981758118,176.09548950195),1202652,3686)
	obj = alife():create("wolffrend_talk_zaton",vector():set(137.19732666016,-7.3405375480652,176.83992004395),1201535,3686)
	set_stalker_story_id(obj,19925)
	db.actor:disable_info_portion("snp_wolffrend_skadovsk_done")
	db.actor:give_info_portion("zvezda_proroka_done")
end

-- Слиток на кольца
function snp_slitok_have()
	return has_alife_info("snp_anna4_done") and db.actor:object("bullion_gild")
end
function snp_slitok_done()
	sak.out_item_namber("bullion_gild",1)
	amk.save_variable("snp_make_rings", amk.game_minutes()+120)
end
function rings_ready()
	return has_alife_info("snp_docent3_done") and not has_alife_info("snp_rings_have") and amk.game_minutes() > amk.load_variable("snp_make_rings", 0)
end

-- Видеоархив
function video_9_have()
	return has_alife_info("snp_proper7014_done") and new_dialog.item_much("snp_video_arhiv",9)
end
function video_10_have()
	return has_alife_info("snpt_x161_done") and new_dialog.item_much("snp_video_arhiv",10)
end
function video_10_done()
	sak.out_item_namber("snp_video_arhiv",10)
end

-- БТР на вышках на свалке
function btr_garbage1_done(num)
	if has_alife_info("snpt_garbage1_fail") then return end

	db.actor:give_info_portion("snp_tmp"..tostring(num))
	
	if  has_alife_info("snp_tmp1") and has_alife_info("snp_tmp2") and has_alife_info("snp_tmp3") and has_alife_info("snp_tmp4") then
		db.actor:give_info_portion("snp_tmp_reset")
		db.actor:disable_info_portion("snp_tmp_reset")
		db.actor:disable_info_portion("no_teleport_near_heli_btr")
		
		if not has_alife_info("snpt_garbage1_have1") then
			db.actor:give_info_portion("snpt_garbage1_have1")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]C первой вышкой ты разобрался, братишка! Тебя ждёт следующая!".."\n", 2, nil, 20000)
		else
			db.actor:give_info_portion("snpt_garbage1_have2")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ФЕНРИР:".."\\n".."%c[255,255,128,128]Молодец! Я не сомневался в тебе! Жарко было? Жду тебя с отчётом!".."\n", 2, nil, 20000)
			-- убираем Фенрира и Вульфа со Скадовска
			alife():release(object_by_section_offline("fenrir_zaton"))
			alife():release(object_by_section_offline("wolffrend_zaton"))
			alife():release(object_by_section_offline("wolffrend_talk_zaton"))
		end
	end
end
function btr_garbage1_fail()
	if has_alife_info("no_teleport_near_heli_btr") then
		db.actor:disable_info_portion("no_teleport_near_heli_btr")
		db.actor:give_info_portion("snp_tmp_reset")
		db.actor:disable_info_portion("snp_tmp_reset")
		db.actor:give_info_portion("snpt_garbage1_fail")
	end
end

-- x-16-Янтарь
function x16_1()
	sak.set_mark_on_tajnik("n_inventory_box_yantar1",vector():set(-25.592491149902,-19.088596343994,-23.444808959961),29512,1492)
	create_restrictor(vector():set(-175.38716125488,-19.114255905151,-42.668083190918),697,1498,2,"snp.x16_2")
end
function x16_2()
	xr_sound.get_safe_sound_object([[snp\zat_b42_controller_warning_1]]):play(db.actor, 0, sound_object.s2d)
	create_restrictor(vector():set(-55.783111572266,-18.853202819824,-67.143280029297),19582,1456,2,"snp.x16_3")
end
function x16_3()
	xr_sound.get_safe_sound_object([[snp\zat_b42_controller_warning_2]]):play(db.actor, 0, sound_object.s2d)
	create_restrictor(vector():set(-57.88639831543,-17.625261306763,-134.35594177246),18645,1491,1,"snp.x16_4")
end
function x16_4()
	xr_sound.get_safe_sound_object([[script_sound\help\soldier\soldier_help_1]]):play(db.actor, 0, sound_object.s2d)
	create_restrictor(vector():set(-26.142684936523,-18.399806976318,-82.548286437988),29275,1492,3,"snp.x16_5")
end
function x16_5()
	xr_sound.get_safe_sound_object([[script_sound\reactions\see_something\soldier\soldier_see_1]]):play(db.actor, 0, sound_object.s2d)
	xr_sound.get_safe_sound_object([[ambient\special\marsh_generator]]):play(db.actor, 3, sound_object.s2d)
	kostya_dialog.create_teleport("snp_x16_tp1",vector():set(-145.96894836426,-18.254137039185,-60.513942718506),1275,1457)
end
function x16_6()
	kostya_dialog.delete_teleport("snp_x16_tp1")
	create_restrictor(vector():set(-25.592491149902,-19.088596343994,-23.444808959961),29512,1492,10,"snp.x16_7")
end
function x16_7()
	xr_sound.get_safe_sound_object([[script_sound\threat\stop\soldier\soldier_stop_1]]):play(db.actor, 0, sound_object.s2d)
	kostya_dialog.create_teleport("snp_x16_tp2",vector():set(-25.592491149902,-19.088596343994,-23.444808959961),29512,1492)
end
function x16_8()
	kostya_dialog.delete_teleport("snp_x16_tp2")
	xr_sound.get_safe_sound_object([[meceniy\atmopheric\smex]]):play(db.actor, 2, sound_object.s2d)
	create_restrictor(vector():set(-241.3547668457,-18.260984420776,-44.497436523438),158,1458,2,"snp.x16_9")
end
function x16_9()
	xr_sound.get_safe_sound_object([[script_replics\comandir_1\normal\comandir_walking_3]]):play(db.actor, 0, sound_object.s2d)
	create_restrictor(vector():set(-70.197463989258,-17.122535705566,-97.257064819336),14118,1496,2,"snp.x16_10")
end
function x16_10()
	xr_sound.get_safe_sound_object([[script_sound\reactions\dead_mutant\soldier\soldier_deadmutant_1]]):play(db.actor, 0, sound_object.s2d)
	create_restrictor(vector():set(-26.588277816772,-17.868045806885,-97.226081848145),29255,1492,1.5,"snp.x16_11")
end
function x16_11()
	xr_sound.get_safe_sound_object([[ambient\zhar]]):play(db.actor, 0, sound_object.s2d)
	kostya_dialog.create_teleport("snp_x16_tp3",vector():set(-87.297988891602,-18.268096923828,-96.16625213623),9080,1496)
end
function x16_12()
	kostya_dialog.delete_teleport("snp_x16_tp3")
	xr_sound.get_safe_sound_object([[script_replics\comandir_1\normal\comandir_to_soldier_4]]):play(db.actor, 2, sound_object.s2d)
	kostya_dialog.create_teleport("snp_x16_tp4",vector():set(-25.592491149902,-19.088596343994,-23.444808959961),29512,1492)
end
function x16_13()
	kostya_dialog.delete_teleport("snp_x16_tp4")
	xr_sound.get_safe_sound_object([[script_replics\stalker_1\newbie\newbie_phrase_artifact_1]]):play(db.actor, 2, sound_object.s2d)
	create_restrictor(vector():set(-147.08406066895,-19.088594436646,-76.49592590332),1077,1457,2,"snp.x16_14")
end
function x16_14()
	xr_sound.get_safe_sound_object([[snp\tube_breath]]):play(db.actor, 0, sound_object.s2d)
	kostya_dialog.create_teleport("snp_x16_tp5",vector():set(-144.91662597656,-18.236173629761,-77.360313415527),1255,1457)
end
function x16_15()
	kostya_dialog.delete_teleport("snp_x16_tp5")
	create_restrictor(vector():set(-25.592491149902,-19.088596343994,-23.444808959961),29512,1492,8,"snp.x16_16")
end
function x16_16()
	xr_sound.get_safe_sound_object([[snp\podoidi_blije]]):play(db.actor, 0, sound_object.s2d)
end
function x16_17()
	xr_sound.get_safe_sound_object([[script_sound\reactions\dead_enemy\soldier\soldier_dead_enemy_1]]):play(db.actor, 2, sound_object.s2d)
	amk.start_timer("run",6,"snp.x16_18()")
end
function x16_18()
	kostya_dialog.create_teleport("snp_x16_tp6", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end
function x16_19()
	kostya_dialog.delete_teleport("snp_x16_tp6")
end

-- Эмбрионы
-- выдача рецепта по эмбрионам
function emb_found_receipt()
	news_manager.send_tip(db.actor, "Получен новый рецепт", nil, nil, 20000)
end

function emb_zahar1_done()
	sak.set_mark_on_tajnik("n_inventory_box_vp2",vector():set(-177.54525756836,9.833262214661,-344.69392700195),38158,3753)
end

-- Жена Сахарова
function gena_start()
	local timeout = 2
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."ЭЛЬЗА:".."\\n".."%c[255,255,128,128]Спасите, нахожусь в здании шко...".."\n", timeout, nil, 20000)
	timeout = timeout+8
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Профессор, кое-что появилось по вашему вопросу. Я только что получил сообщение непонятное, но думаю, оно отправлено интересующей вас личностью.".."\n", timeout, nil, 20000)
	timeout = timeout+8
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."САХАРОВ:".."\\n".."%c[255,255,128,128]Стрелок, будете в наших краях - загляните. Кажется, я догадываюсь, о ком вы говорите.".."\n", timeout, nil, 20000)
	db.actor:give_info_portion("gena_sakharov1_start")
end

function gena_bum1()
	sak.set_mark_on_tajnik("n_inventory_box_bum1",vector():set(-4.2317895889282,-29.182376098633,11.760759353638),1804,2481)
end

function gena_sakharov1_done()
	sak.set_mark_on_tajnik("n_inventory_box_as2",vector():set(-244.18141174316,-2.3535263061523,293.23202514648),88245,1797)
end
function gena_sakharov2_done()
	kostya_dialog.create_teleport("gena_tp2", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end

function gena_oso1_start()
	all_spawn_fix.release_allspawn_object("mon_stalker")
	local restrictions_bum = {
		["mon_monolith_proektor_restr"] = true,
		["mon_guard_offline_restr"] = true
	}
	remove_all_restrictions(restrictions_bum)
	local obj = alife():create("gena_oso",vector():set(17.6636276245117,-41.899284362793,25.8659324645996),2927,2512)
	set_stalker_story_id(obj,19932)
end

function gena_oso1_done()
	kostya_dialog.delete_teleport("gena_tp1")
	amk.remove_item_from_inventory_by_name("gena_note5",db.actor)
	local obj = alife():create("elsa_yantar",vector():set(25.738025665283,-11.717874526978,-273.18176269531),51613,1480)
	set_stalker_story_id(obj,19931)
	amk.start_timer("teleport_jumpto", 0.2, "gena_exit5")
end

function gena_finish()
	kostya_dialog.delete_teleport("gena_tp2")
	alife():release(object_by_section_offline("gena_oso"))
	alife():create(alife():spawn_id(1307))
end

----------------- Разные утилиты -------------------

-- присвоение неписю story_id при скриптовом спавне
function set_stalker_story_id(obj,sid)
	local params = amk.read_stalker_params(obj)
	params.sid = sid
	amk.write_stalker_params(params,obj)
end

-- установка object_flags непися при скриптовом спавне
function set_stalker_oflags(obj,oflags)
	local params = amk.read_stalker_params(obj)
	params.oflags = oflags
	amk.write_stalker_params(params,obj)
end

-- поиск онлайнового объекта скриптового спавна по секции
function object_by_section(section)
	local obj
	for k,v in pairs(db.storage) do
		obj = level.object_by_id(k)
		if obj:section() == section then
			return obj
		end
	end
	return nil
end

-- поиск онлайнового неприбинденного объекта (отсутствует в db.storage) скриптового спавна по секции
function object_by_section_nobinder(section)
	local obj
	for i=1,65534 do
		obj=level.object_by_id(i)
		if obj and obj:section() == section then
			return obj
		end
	end
	return nil
end

-- поиск оффлайнового объекта скриптового спавна по секции - alife():object() тут не работает
function object_by_section_offline(section)
	local obj
	for i=1,65534 do
		obj = alife():object(i)
		if obj and obj:section_name() == section then
			return obj
		end
	end
	return nil
end

-- удаление всех онлайновых обьектов по секции
function release_all_online(section)
	local obj
	for k,v in pairs(db.storage) do
		obj = level.object_by_id(k)
		if obj:section() == section then
			alife():release(alife():object(obj:id()))
		end
	end
end

-- Спавн тайника/предмета с установкой рестриктора
-- Описание: рестриктор спавнится по координатам объекта. Параметры задаются в конфиге объекта:
-- r_radius   = радиус рестриктора. по умолчанию = 5
-- r_function = функция, которую вызвать при входе в рестриктор, без кавычек, скобок и параметров
-- Возвращает ссылку на объект
function create_item_and_restrictor(section,pos,lv,gv)
	-- спавним объект
	local obj = alife():create(section,pos,lv,gv)

	local radius = rx_utils.read_from_ini(nil, section, "r_radius", nil, 3)
	local func = rx_utils.read_from_ini(nil, section, "r_function", nil, 1)
	
	if func then
		if not radius then radius = 5 end
		-- функция есть - спавним рестриктор
		create_restrictor(pos,lv,gv,radius,func)
	end
	
	return obj
end

-- Спавн типичного рестриктора на вход. func = вызываемая при входе функция.
function create_restrictor(pos,lv,gv,radius,func)
	local se_obj = alife():create("space_restrictor",pos,lv,gv)
	local custom = "[logic]\nactive = sr_idle\n[sr_idle]\non_actor_inside = nil %="..func.."%"
	spawn_restrictor.rewrite_restrictor(se_obj, custom, radius)
	return se_obj
end

-- Спавн типичного рестриктора на выход. func = вызываемая при выходе функция.
function create_restrictor_out(pos,lv,gv,radius,func)
	local se_obj = alife():create("space_restrictor",pos,lv,gv)
	local custom = "[logic]\nactive = sr_idle\n[sr_idle]\non_actor_outside = nil %="..func.."%"
	spawn_restrictor.rewrite_restrictor(se_obj, custom, radius)
	return se_obj
end

-- Спавн типичного рестриктора на вход со сработкой в определенное время.
function create_restrictor_timer(pos,lv,gv,radius,timer,func)
	local se_obj = alife():create("space_restrictor",pos,lv,gv)
	local custom = "[logic]\nactive = sr_idle\n[sr_idle]\non_actor_inside = {=in_timer("..timer..")} nil %="..func.."%"
	spawn_restrictor.rewrite_restrictor(se_obj, custom, radius)
	return se_obj
end

-- Спавн типичного рестриктора на вход со сработкой в определенное время для сюжета оп Теням.
function create_restrictor_timer_pftp(pos,lv,gv,radius,timer,func)
	local se_obj = alife():create("space_restrictor",pos,lv,gv)
	local custom = "[logic]\nactive = sr_idle\n[sr_idle]\non_actor_inside = {=in_timer_pftp("..timer..")} nil %="..func.."%"
	spawn_restrictor.rewrite_restrictor(se_obj, custom, radius)
	return se_obj
end

-- Спавн зоны на основе рестриктора. При входе в зону выдается поршень info, при выходе - снимается. Работать начинает при входе ГГ в зону
-- off - поршень, при выдаче которого зона отключается.
function create_zone(pos,lv,gv,radius,info,off)
	local se_obj = alife():create("space_restrictor",pos,lv,gv)
	local custom = 
	"[logic]\n"..
	"active = sr_idle@in\n"..

	"[sr_idle@in]\n"..
	"on_actor_inside = sr_idle@out %+"..info.."%\n"..
	"on_info = {+"..off.."} nil %-"..info.."%\n"..

	"[sr_idle@out]\n"..
	"on_actor_outside = sr_idle@in %-"..info.."%\n"..
	"on_info = {+"..off.."} nil %-"..info.."%\n"
	spawn_restrictor.rewrite_restrictor(se_obj, custom, radius)
	return se_obj
end

-- Убираем ПЫСсовские рестрикторы на территории, чтобы не вылетало по путям. На входе список рестрикторов
function remove_all_restrictions(restrictions)
	local obj
	for id=1, 65534 do
		obj = level.object_by_id(id)
		if obj and restrictions[obj:name()] then
--			get_console():execute("load ~~~ name:"..obj:name())
			alife():release(alife():object(obj:id()))
		end
	end
end

-- Спавн трупа
function create_trup(section,pos,lv,gv,sid)
	local obj = alife():create(section,pos,lv,gv)
	local params = amk.read_stalker_params(obj)
	if sid then
		params.sid = sid
	end
	params.health = 0
	params.updhealth = 0
	amk.write_stalker_params(params,obj)
	return obj
end

-- Спавн раненого
function create_wounded(section,pos,lv,gv,sid)
	local obj = alife():create(section,pos,lv,gv)
	local params = amk.read_stalker_params(obj)
	if sid then
		params.sid = sid
	end
	params.health = 0.1
	params.updhealth = 0.05
	amk.write_stalker_params(params,obj)
	return obj
end

function invul_on()
	inventory.get_free_belt_slot()
	amk.spawn_item_in_inv("af_invul", db.actor)
end
function invul_off()
	local obj = db.actor:object("af_invul")
	if obj then
		alife():release(alife():object(obj:id()))
	end
end

function move_on()
	local obj = db.actor:object("ballast")
	if obj then
		alife():release(alife():object(obj:id()))
	end
end
function move_off()
	amk.spawn_item_in_inv("ballast", db.actor)
end

-- Пьем водку
function drink_vodka()
	alife():create("vodka",vector():set(0,0,0),0,0,0)
	amk.start_timer("run",0.2,"snp.drink_vodka_chunk()")
end
function drink_vodka_chunk()
	db.actor:eat(db.actor:object("vodka"))
end

-- подсчет количества вертолетов в онлайне для бойни на Юпитере
function count_heli()
	local count = 0
	for k,v in pairs(db.heli) do
		if v:section() == "snp_helicopter" then
			count = count+1
		end
	end
	return count
end

-- подсчет количества бтр в онлайне
function count_btr()
	local count = 0
	for k,v in pairs(db.btr) do
		count = count+1
	end
	return count
end

function net_spawn()
	start_sound()
	emb.start_sound()
	
	-- спавн бункера
	if has_alife_info("snp_resident_evil8_done") and not has_alife_info("spawn_bunker_jupiter") and level.name()=="jupiter" then
		spawn_bunker_jupiter()
		db.actor:give_info_portion("spawn_bunker_jupiter")
	end
	-- финальное удаление Снегиря
	if has_alife_info("fli_snegir1_done") and not has_alife_info("fli_snegir_remove") and level.name()~="l01_escape" then
		alife():release(object_by_section_offline("maria_kordon"))
		alife():release(object_by_section_offline("snegir_kordon"))
		db.actor:give_info_portion("fli_snegir_remove")
	end
	-- перемещение Котобегемота и Ариадны на Скадовск
	if has_alife_info("snp_docent2_done") and not has_alife_info("ariadna_kot_to_skadovsk") and level.name()~="l05_bar" then
		alife():release(object_by_section_offline("kotobegemot_bar"))
		alife():release(object_by_section_offline("ariadna_bar"))
		local obj = alife():create("kotobegemot_zaton",vector():set(132.33285522461,-7.3398036956787,177.00312805176),1193473,3686)
		set_stalker_story_id(obj,19920)
		obj = alife():create("ariadna_zaton",vector():set(133.59469604492,-7.3404812812805,177.0399017334),1195789,3686)
		set_stalker_story_id(obj,19921)
		db.actor:give_info_portion("ariadna_kot_to_skadovsk")
	end
	-- перемещение бункера на Скадовск
	if has_alife_info("snp_proper7013_done") and not has_alife_info("bunker_to_skadovsk") and level.name()~="jupiter" then
		alife():release(object_by_section_offline("fenrir_jupiter"))
		alife():release(object_by_section_offline("proper70_jupiter"))
		local obj = alife():create("fenrir_zaton",vector():set(138.73059082031,-7.3394303321838,178.58042907715),1203766,3686)
		set_stalker_story_id(obj,19902)
		obj = alife():create("resident_evil_zaton",vector():set(125.20777893066,-7.3201112747192,181.31158447266),1181686,3686)
		set_stalker_story_id(obj,19903)
		obj = alife():create("proper70_zaton",vector():set(126.26544952393,-7.3198008537292,176.6022644043),1182876,3686)
		set_stalker_story_id(obj,19922)
		obj = alife():create("anna_zaton2",vector():set(138.39352416992,-7.3401217460632,179.81733703613),1203770,3686)
		set_stalker_story_id(obj,19923)
		db.actor:give_info_portion("bunker_to_skadovsk")
	end
	-- удаление Вожака с плато
	if has_alife_info("snp_wolffrend3_done") and not has_alife_info("snp_vogak_remove") and level.name()~="zaton" then
		alife():release(object_by_section_offline("wolffrend_zaton2"))
		alife():release(object_by_section_offline("wolffrend_talk_zaton2"))
		db.actor:give_info_portion("snp_vogak_remove")
	end
end

-- апдейт раз в полсекунды
function update()
	-- отсечка на Юпитере
	if  has_alife_info("no_teleport_near_heli_btr") and	has_alife_info("snp_boroda_start_done") and not has_alife_info("snp_parad_start") and not has_alife_info("snpt_jupiter5_fail") then
	
		if db.actor:position().y < 40 then
			db.actor:give_info_portion("snpt_jupiter5_fail")
			news_manager.send_tip(db.actor, "%c[255,160,160,160]".."БОРОДА:".."\\n".."%c[255,255,128,128]Если ты поднялся наверх - то нельзя возвращаться назад, пока не найдёшь мой рюкзак.".."\n", nil, nil, 20000)
			
		elseif has_alife_info("snpt_jupiter5_have1") and not has_alife_info("snpt_jupiter5_have2") and count_heli() == 0 then
			snp_spawn.create_snpt_jupiter5_restr3()
			db.actor:give_info_portion("snpt_jupiter5_have2")

		end
	end
end

-- запуск сюжетных звуков
function start_sound()
	if     has_alife_info("snp_monolith1_done") and not has_alife_info("snp_almaz1") and level.name()=="av_peshera" then
		xr_sound.get_safe_sound_object([[snp\heartbeat100]]):play_at_pos(db.actor, vector():set(-108.42949676514,40.053085327148,479.11297607422), 0, sound_object.s3d+sound_object.looped)

	elseif has_alife_info("snp_almaz1") and not has_alife_info("snp_almaz2") and level.name()=="av_peshera" then
		xr_sound.get_safe_sound_object([[snp\heartbeat100]]):play_at_pos(db.actor, vector():set(174.08480834961,55.11833190918,386.01168823242), 0, sound_object.s3d+sound_object.looped)
	end
end

function play_snd_rnd_ratchant()
	xr_sound.get_safe_sound_object([[ambient\random\rnd_ratchant]]):play_no_feedback(db.actor, sound_object.s2d, 1, vector(), 1.0)
end

-- для диалогов
function bubulyka_answer1()
	local task_texture, task_rect = get_texture_info("ui_iconsTotal_lost_money")
	db.actor:give_talk_message("Спасибо, "..user_name()..", за честный ответ! Мне тоже с тобой было очень приятно общаться! А что касается тайника - я электриком работал на большой земле, так вот, есть у меня в Зоне дружок один, он тоже электрик, зовут паренька Слипкнот. И он рассказал мне про этот тайник. А спрятал он его на Затоне за Железным лесом, за границей территории, рядом с трансформаторной подстанцией №1758, что на крыше завода.", task_texture, task_rect, "simple_answer_item")
end

